!function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(){var e=t.username,o=t.password;return!e||e.length<3?void t.toast("用户名太短"):!e||e.length>25?void t.toast("用户名太长"):!o||o.length<4?void t.toast("请输入正确的密码"):void s.auth.base.signin({username:e,password:o}).then(function(e){e?(t.toast("登录成功"),t.goHome()):t.toast("用户名或密码错误")})}function l(){r.go("signup",{})}function d(){r.go("forget",{})}function p(){r.go("wechat-auth",{})}function h(){r.go("qq-auth",{})}function g(){var t=c.getConfig(),e=t["wechat.web"];return e&&i.isWeixin()}t.isMobileSigninEnable=c.getFeature()["signin.mobile"],t.isDefaultSigninEnable=c.getFeature()["signin.default"],t.userNameHine="请输入用户名/邮箱/手机号",t.isMobileSigninEnable&&t.isDefaultSigninEnable?t.userNameHine="请输入用户名/邮箱/手机号":t.isMobileSigninEnable?t.userNameHine="请输入手机号":t.userNameHine="请输入用户名/邮箱",t.username="",t.password="",t.touchSignin=u,t.touchSignup=l,t.touchForget=d,t.touchWeixin=p,t.touchQQ=h,t.isWeixin=g}angular.module("app").controller("SigninController",t),t.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","ENUM","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("signin",{needAuth:!1,url:"/signin",title:"用户登录",templateUrl:"modules/signin/signin.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l){function d(){t.currentTab!=t.TAB_MOBILE&&(t.currentTab=t.TAB_MOBILE,t.signupMobile={show:!0})}function p(){t.currentTab!=t.TAB_EMAIL&&(t.currentTab=t.TAB_EMAIL,t.signupMobile={show:!1})}function h(){var e=t.state.username,o=t.state.password,n=t.state.password2,r=t.state.email;if(!e||e.length<3)return void t.toast("用户名太短");if(!e||e.length>25)return void t.toast("用户名太长");if(!o||o.length<6)return void t.toast("请输入正确的密码");if(o!=n)return t.toast("请输入正确的密码"),void(t.password2="");if(!r||r.length<5)return void t.toast("请输入正确的邮箱地址");var i={};i.username=e,i.password=o,i.email=r,c.getReferences()&&(i.invite_code=parseInt(c.getReferences())),s.auth["default"].signup(i).then(function(e){e.data&&a.ERROR_CODE.OK==e.data.error_code?(t.toast("注册成功"),t.goHome()):t.toast(e.data.error_desc)})}function g(){var e=60,o=void 0;o=u(function(){0>=e?(u.cancel(o),o=void 0,e=60,t.paracont="重发验证码",t.paraclass="mobile-code",t.paraevent=!0):(t.paracont=e+"s",t.paraclass="not-mobile-code",t.paraevent=!1,e--)},1e3,100)}function f(){if(t.paraevent){var e=t.state.mobile;if(!e||e.length<1)return void t.toast("请输入手机号码");var o={};o.mobile=e,o.code="86",s.auth.mobile.verify(o).then(function(e){e&&s.auth.mobile.send(o).then(function(e){e.data&&a.ERROR_CODE.OK==e.data.error_code?g():t.toast(e.data.error_desc)})})}}function m(){var e=t.state.mobile,o=t.state.mobile_code,n=t.state.mobile_password,r=t.state.mobile_password2;if(!e||e.length<1)return void t.toast("请输入手机号码");if(!o||6!=o.length)return void t.toast("请输入正确的手机验证码");if(!n||n.length<6)return void t.toast("请输入正确的密码");if(n!=r)return t.toast("请输入正确的密码"),void(t.password2="");var i={};i.mobile=e,i.code=o,i.password=n,c.getReferences()&&(i.invite_code=parseInt(c.getReferences())),s.auth.mobile.signup(i).then(function(e){e.data&&a.ERROR_CODE.OK==e.data.error_code?(t.toast("手机号注册成功"),t.goHome()):t.toast(e.data.error_desc)})}function v(){o.location.href=t.siteInfo.terms_url}function S(){s.site.get().then(function(e){t.siteInfo=e})}t.TAB_MOBILE=0,t.TAB_EMAIL=1,t.currentTab=t.TAB_MOBILE,"mobile"==i.tab?t.currentTab=t.TAB_MOBILE:"email"==i.tab?t.currentTab=t.TAB_EMAIL:t.currentTab=t.TAB_MOBILE,t.isMobileSigninEnable=l.getFeature()["signup.mobile"],t.isDefaultSigninEnable=l.getFeature()["signup.default"],t.touchTabMobile=d,t.touchTabEmail=p,!t.isMobileSigninEnable&&t.isDefaultSigninEnable?t.signupMobile={show:!1}:t.signupMobile={show:!0},t.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},t.touchSignup=h,t.touchSignupMobile=m,t.toucheMobileCode=f,t.touchLicense=v,t.siteInfo={},t.paracont="获取验证码",t.paraclass="mobile-code",t.paraevent=!0,S()}angular.module("app").controller("SignupController",t),t.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("signup",{needAuth:!1,url:"/signup",title:"用户注册",templateUrl:"modules/signup/signup.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l){function d(){t.currentTab!=t.TAB_MOBILE&&(t.currentTab=t.TAB_MOBILE,t.forgetMobile={show:!0})}function p(){t.currentTab!=t.TAB_EMAIL&&(t.currentTab=t.TAB_EMAIL,t.forgetMobile={show:!1})}function h(){var e=60,o=void 0;o=u(function(){0>=e?(u.cancel(o),o=void 0,e=60,t.paracont="重发验证码",t.paraclass="mobile-code",t.paraevent=!0):(t.paracont=e+"s",t.paraclass="not-mobile-code",t.paraevent=!1,e--)},1e3,100)}function g(){if(t.paraevent){var e=t.state.mobile;if(!e||e.length<1)return void t.toast("请输入手机号码");var o={};o.mobile=e,o.code="86",s.auth.mobile.send(o).then(function(e){e.data&&a.ERROR_CODE.OK==e.data.error_code?h():t.toast(e.data.error_desc)})}}function f(){var e=t.state.mobile,o=t.state.mobile_code,n=t.state.mobile_password,r=t.state.mobile_password2;if(!e||e.length<1)return void t.toast("请输入手机号码");if(!o||6!=o.length)return void t.toast("请输入正确的手机验证码");if(!n||n.length<6)return void t.toast("请输入正确的密码");if(n!=r)return t.toast("请输入正确的密码"),void(t.password2="");var i={};i.mobile=e,i.code=o,i.password=n,c.getReferences()&&(i.invite_code=parseInt(c.getReferences())),s.auth.mobile.reset(i).then(function(e){e.data&&a.ERROR_CODE.OK==e.data.error_code?(t.toast("找回密码成功"),t.goBack()):t.toast(e.data.error_desc)})}function m(){var e=t.input.email;return!e||e.length<4?void t.toast("请输入正确的邮箱"):void s.auth["default"].reset({email:e}).then(function(o){var n=a.ERROR_CODE.OK==o.data.error_code;t.success=n,n?t.email=e:t.toast(o.data.error_desc)})}function v(){t.goBack()}t.isDefaultFindpassEnable=l.getFeature()["findpass.default"],t.isMobileFindpassEnable=l.getFeature()["findpass.mobile"],t.TAB_MOBILE=0,t.TAB_EMAIL=1,t.currentTab=t.TAB_MOBILE,"mobile"==i.tab?t.currentTab=t.TAB_MOBILE:"email"==i.tab?t.currentTab=t.TAB_EMAIL:t.currentTab=t.TAB_MOBILE,t.touchTabMobile=d,t.touchTabEmail=p,t.toucheMobileCode=g,t.touchforgetMobile=f,t.touchBackLogin=v,t.isDefaultFindpassEnable&&!t.isMobileFindpassEnable?t.forgetMobile={show:!1}:t.forgetMobile={show:!0},t.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},t.paracont="获取验证码",t.paraclass="mobile-code",t.paraevent=!0,t.success=!1,t.email="",t.input={email:""},t.touchSendMail=m}angular.module("app").controller("ForgetController",t),t.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("forget",{needAuth:!1,url:"/forget",title:"找回密码",templateUrl:"modules/forget/forget.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l,d,p){function h(){i.go("search",{})}function g(e){return e.link&&e.link.length?void(u.location.href=e.link):void t.toast("没有链接")}function f(t){i.go("home",{})}function m(t){i.go("search-result",{sortKey:a.SORT_KEY.DEFAULT,sortValue:a.SORT_VALUE.DEFAULT,keyword:null,category:t.id,navTitle:t.name,navStyle:"default"})}function v(t){i.go("search-result",{sortKey:a.SORT_KEY.DEFAULT,sortValue:a.SORT_VALUE.DEFAULT,keyword:null,brand:t.id,navStyle:"default"})}function S(){i.go("recommended-brands",{})}function y(){i.go("recommended-shops",{})}function $(t){i.go("shop-home",{shop:t.id})}function A(t){i.go("product",{product:t.id})}function E(){s.banner.list({page:1,per_page:I}).then(function(e){t.banners=e;n(function(){t.bannerSwiper=new Swiper(".home-banner",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1)})}function T(){t.isLoading||t.isLastPage||(t.recommendProducts&&t.recommendProducts.length?P(t.recommendProducts.length/U+1,U):P(1,U))}function P(e,o){t.isLoading=!0;var n={};n.page=e,n.per_page=o,s.recommend.productList(n).then(function(e){t.recommendProducts=t.recommendProducts?t.recommendProducts.concat(e):e,t.isEmpty=!t.recommendProducts||!t.recommendProducts.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=e&&e.length<o?!t.isEmpty:!1})}function L(){t.isLoading||(t.recommendProducts=null,t.isLoaded=!1,P(1,U))}function C(){s.recommend.brandList({page:1,per_page:R}).then(function(e){t.recommendBrands=e})}function w(){s.recommend.shopList({page:1,per_page:R}).then(function(e){t.recommendShops=e})}function M(){return c.FOR_WEIXIN&&!l.getOpenId()&&o.isWeixin()?void i.go("wechat-authbase",{}):(p.fetch(),s.config.get().then(function(e){t.isB2B2C=e.platform.type,t.isB2B2C?(E(),w(),C(),L()):(E(),p.fetch().then(function(){var t=p.getConfig(),e=t["wechat.web"];return e&&c.FOR_WEIXIN&&!l.getOpenId()&&o.isWeixin()?void i.go("wechat-authbase",{}):void b()}))}),void t.cartModel.reloadIfNeeded())}function _(t,e){if(t){wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:t.app_id,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]});var n=e;wx.ready(function(){wx.onMenuShareTimeline({title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){},cancel:function(){}})}),wx.error(function(t){GLOBAL_CONFIG.DEBUG&&o.toast(JSON.stringify(t))})}}function b(){t.isB2B2C||l.getToken()&&s.bonus.get().then(function(t){p.fetch().then(function(){var e=p.getConfig(),o=e["wxpay.web"];return _(o,t.shared_link),!0})})}var I=10,U=4,R=8;t.banners=[],t.notices=[];for(var D={},O=[],B=0;U>B;++B)O.push(D);t.recommendProducts=O,t.newArrival=O,t.editorChoice=O,t.touchSearch=h,t.touchBanner=g,t.touchShop=$,t.touchCategory=m,t.touchProduct=A,t.touchBrand=v,t.touchGroup=f,t.touchShopList=y,t.touchBarndList=S,t.reload=M,t.loadMoreProduct=T,t.isEmpty=!1,t.isLoaded=!1,t.isLoading=!1,t.isLastPage=!1,t.cartModel=d,t.isB2B2C=!1,M()}angular.module("app").controller("HomeController",t),t.$inject=["$scope","$http","$rootScope","$timeout","$location","$state","API","ENUM","CONSTANTS","$window","AppAuthenticationService","CartModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("index",{needAuth:!1,url:"?token",title:"首页",templateUrl:"modules/home/home.html"}),t.state("home",{needAuth:!1,url:"/home",title:"首页",templateUrl:"modules/home/home.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s){function a(){n.go("search",{})}function c(e){t.selectedSide=e,t.subCategories=e.categories}function u(e){if(e)n.go("search-result",{sortKey:i.SORT_KEY.DEFAULT,sortValue:i.SORT_VALUE.DEFAULT,keyword:null,category:e.id,navTitle:e.name,navStyle:"default"});else{var o=t.selectedSide;n.go("search-result",{sortKey:i.SORT_KEY.DEFAULT,sortValue:i.SORT_VALUE.DEFAULT,keyword:null,category:o.id,navTitle:o.name,navStyle:"default"})}}function l(){r.category.list({page:1,per_page:p}).then(function(e){e&&e.length?(t.categories=e,t.selectedSide=e[0],t.subCategories=e[0].categories):(t.categories=null,t.selectedSide=null,t.subCategories=null)})}function d(){l()}var p=1e3;t.categories=[],t.selectedSide=null,t.touchSearch=a,t.touchSide=c,t.touchMain=u,t.cartModel=s,d()}angular.module("app").controller("CategoryController",t),t.$inject=["$scope","$http","$location","$state","API","ENUM","CartModel"]}(),function(){"use strict";function t(t,e){t.state("category",{needAuth:!1,url:"/category",title:"商品分类",templateUrl:"modules/category/category.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){var t=0;if(this.groups)for(var e=this.groups,o=0;o<e.length;++o)for(var n=e[o],r=0;r<n.goods.length;++r)t+=n.goods[r].amount;this.total=t,this.totlaNum=t>99?"99+":t}function u(t,e,o){if(i.getToken()){var n=this;return s.cart.add({product:t,property:JSON.stringify(e),amount:o}).then(function(t){return t&&n.reload(),t})}}function l(t){if(i.getToken()){var e=this;return s.cart["delete"]({good:t}).then(function(o){if(o){for(var n=e.groups,r=0;r<n.length;++r)for(var i=n[r],s=0;s<i.goods.length;++s){var a=i.goods[s];if(a.id==t){i.goods.splice(s,1);break}}e.isEmpty=!e.groups||!e.groups.length,e.count()}return o})}}function d(t,e){if(i.getToken()){var o=this;return s.cart.update({good:t,amount:e}).then(function(n){if(n){for(var r=o.groups,i=0;i<r.length;++i)for(var s=r[i],a=0;a<s.goods.length;++a){var c=s.goods[a];if(c.id==t){c.amount=e;break}}o.isEmpty=!o.groups||!o.groups.length,o.count()}return n})}}function p(){if(!i.getToken())return this.total=0,g.total=0,this.totlaNum="",void(g.totlaNum="");var t=this;return s.cart.get({}).then(function(e){return e&&(t.groups=e,t.isEmpty=!t.groups||!t.groups.length,t.isLoaded=!0,t.isLoading=!1,t.count()),s.order.subtotal().then(function(e){t.subtotal=e}),!!e})}function h(){this.reload()}var g={};return g.isEmpty=!1,g.isLoaded=!1,g.isLoading=!1,g.isLastPage=!1,g.total=0,g.totlaNum="",g.subtotal={},g.groups=null,g.count=c,g.add=u,g["delete"]=l,g.update=d,g.reload=p,g.reloadIfNeeded=h,g}angular.module("app").factory("CartModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s){function a(e){t.deletingGoods=e,t.showDialog=!0}function c(){t.showDialog=!1,t.deletingGoods=null}function u(){t.deletingGoods&&(t.cartModel["delete"](t.deletingGoods.id).then(function(e){if(e){for(var o=t.selectedGoods,n=0;n<o.length;++n){var r=o[n];if(r.id==t.deletingGoods.id){o.splice(n,1);break}}t.toast("删除成功"),t.showDialog=!1,t.deletingGoods=null,t.cartModel.reload();t.cartModel.groups;y()}}),t.showDialog=!1)}function l(t){n.go("product",{product:t.id})}function d(){return t.selectedGoods&&t.selectedGoods.length?(r.clear(),r.goods=t.selectedGoods,r.shop=t.selectedShop,void n.go("confirm-cart",{})):void t.toast("请先选择商品")}function p(e){t.cartModel.update(e.id,e.amount+1).then(function(t){y()})}function h(e){e.amount<=1||t.cartModel.update(e.id,e.amount-1).then(function(t){y()})}function g(e){for(var o=t.selectedGoods,n=-1,r=0;r<o.length;++r){var i=o[r];if(i.id==e.id){n=r;break}}-1==n?o.push(e):o.splice(n,1),y()}function f(){var e=t.cartModel.groups,o=[],n=!t.isSelectedAll;if(n)for(var r=0;r<e.length;++r)for(var i=e[r],s=0;s<i.goods.length;++s){var a=i.goods[s];o.push(a)}t.selectedGoods=o,t.isSelectedAll=n,y()}function m(e){var o=t.cartModel.groups;o.length?t.isSelectedAll=!1:t.isSelectedAll=!0,t.selectedGoods=e.goods,t.selectedShop=e.shop,y()}function v(e){for(var o=t.selectedGoods,n=0;n<o.length;++n)if(e.id==o[n].id)return!0;return!1}function S(e){for(var o=t.selectedGoods,n=0;n<e.goods.length;n++)for(var r=e.goods[n],i=0;i<o.length;++i)if(r.id==o[i].id)return!0;return!1}function y(){for(var e=0,o=0,n=t.selectedGoods,r=0;r<n.length;++r)e+=n[r].amount,o+=n[r].amount*n[r].price;t.selectedAmount=e,t.selectedPrice=o}function $(){t.cartModel.reload()}t.showDialog=!1,t.deletingGoods=null,t.touchDelete=a,t.touchDialogCancel=c,t.touchDialogConfirm=u,t.touchProduct=l,t.touchSubmit=d,t.touchAmountSub=h,t.touchAmountAdd=p,t.touchSelect=g,t.touchSelectAll=f,t.touchSelectShop=m,t.isSelected=v,t.isSelectedShop=S,t.isSelectedAll=!1,t.selectedGoods=[],t.selectedAmount=0,t.selectedPrice=0,t.cartModel=i;var A=s.getPlatform();t.isB2B2C=A.type,$()}angular.module("app").controller("CartController",t),t.$inject=["$scope","$http","$location","$state","ConfirmCartService","CartModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("cart",{needAuth:!0,url:"/cart",title:"购物车",templateUrl:"modules/cart/cart.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e){t.state("cart-select",{needAuth:!0,url:"/cart-select",title:"购物车",templateUrl:"modules/cart-select/cart-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){r.go("my-order",{tab:"all"})}function d(){r.go("my-order",{tab:"created"})}function p(){r.go("my-order",{tab:"paid"})}function h(){r.go("my-order",{tab:"delivering"})}function g(){r.go("my-order",{tab:"delivered"})}function f(){r.go("my-favorite",{})}function m(){r.go("my-address",{})}function v(){r.go("my-score",{tab:"all"})}function S(){r.go("my-cashgift",{})}function y(){r.go("my-coupon",{})}function $(){r.go("article",{})}function A(){r.go("change-password",{})}function E(){s.getToken()||t.goSignin()}function T(){s.getToken()&&i.auth.base.signout().then(function(e){e?(t.goHome(),t.toast("注销成功")):t.toast("注销失败")})}function P(){_()&&i.user.profileGet().then(function(e){s.setUser(e),t.user=e})}function L(){P(),t.cartModel.reloadIfNeeded()}function C(){return o.isWeixin()}function w(){r.go("bonus",{})}function M(){r.go("my-balance",{})}function _(){return s.getToken()}t.isB2B2C=u.getPlatform().type,t.isCashgiftEnable=u.getFeature().cashgift,t.isCouponEnable=u.getFeature().coupon,t.isScoreEnable=u.getFeature().score,t.touchAllOrders=l,t.touchOrderCreated=d,t.touchOrderPayed=p,t.touchOrderDelivering=h,t.touchOrderDelivered=g,t.touchFav=f,t.touchAddress=m,t.touchScore=v,t.touchCashGift=S,t.touchHelps=$,t.touchPassword=A,t.touchSignin=E,t.touchSignout=T,t.touchBonus=w,t.touchBalance=M,t.isSignIn=_,t.touchMyCoupon=y,t.uploader=c.initUploader(function(e,o,n,r){200==n&&o.user&&(GLOBAL_CONFIG.ENCRYPTED||(t.toast("上传成功"),P()))}),t.refreshUrl=function(t){var e=Math.round((new Date).getTime()/1e3);return-1==t.indexOf("?")?t+"?v="+e:t+"&v="+e},t.isWeixin=C,t.cartModel=a,t.user=s.getUser(),u.fetch();var b=u.getConfig();t.authorize=b.authorize,L()}angular.module("app").controller("ProfileController",t),t.$inject=["$scope","$http","$rootScope","$location","$state","API","AppAuthenticationService","CartModel","FileUploadService","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("profile",{needAuth:!0,url:"/profile",title:"个人中心",templateUrl:"modules/profile/profile.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){function s(){this.history=null}var a={};return a.history=null,a.clear=s,i.$on("searchChanged",function(t,e){if(e&&e.length){var o=a.history?a.history.indexOf(e):-1;-1==o&&(a.history=a.history||[],a.history.push(e))}}),a}angular.module("app").factory("SearchService",t),t.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){if(!t.currentKeyword||t.currentKeyword.length<1)return void t.toast("请输入正确的关键字");r.$emit("searchChanged",t.currentKeyword);var e=0,o=0;t.isSearchGoods?(e=a.SORT_KEY.DEFAULT,o=a.SORT_VALUE.DEFAULT):(e=a.SORT_KEY.POPULAR,o=a.SORT_VALUE.DESC),i.go("search-result",{sortKey:e,sortValue:o,keyword:t.currentKeyword,category:null,isSearchGoods:t.isSearchGoods,navTitle:t.currentKeyword,navStyle:"search"})}function d(){t.showTypeChose?t.showTypeChose=0:t.showTypeChose=1}function p(e){e?t.isSearchGoods=1:t.isSearchGoods=0}function h(){t.showTypeChose=0}function g(e){if(!e||e.length<1)return void t.toast("请输入正确的关键字");t.currentKeyword=e,r.$emit("searchChanged",e),t.showTypeChose=0;var o=0,n=0;t.isSearchGoods?(o=a.SORT_KEY.DEFAULT,n=a.SORT_VALUE.DEFAULT):(o=a.SORT_KEY.POPULAR,n=a.SORT_VALUE.DESC),i.go("search-result",{sortKey:o,sortValue:n,keyword:e,category:null,isSearchGoods:t.isSearchGoods,navTitle:e,navStyle:"search"})}function f(){s.search.keywordList({}).then(function(e){t.keywords=e})}function m(){f()}t.currentKeyword="",t.keywords=null,t.history=c.history,t.touchSearch=l,t.touchKeyword=g,t.showTypeChose=0,t.touchTypeChose=d,t.hideTypeChose=h,t.isSearchGoods=1,t.choseType=p,t.isB2B2C=u.getPlatform().type,m()}angular.module("app").controller("SearchController",t),t.$inject=["$scope","$http","$window","$timeout","$rootScope","$state","API","ENUM","SearchService","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("search",{needAuth:!1,url:"/search",title:"搜索",templateUrl:"modules/search/search.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){t.isSearchGoods?v():E()}function d(){var e=c.SORT_KEY.DEFAULT,o=c.SORT_VALUE.DEFAULT;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,v())}function p(){var e=c.SORT_KEY.SALE,o=c.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,v())}function h(){var e=c.SORT_KEY.DATE,o=c.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,v())}function g(){var e=c.SORT_KEY.PRICE,o=c.SORT_VALUE.DESC;t.currentSortKey==c.SORT_KEY.PRICE?t.currentSortValue==c.SORT_VALUE.DEFAULT||t.currentSortValue==c.SORT_VALUE.ASC?(e=c.SORT_KEY.PRICE,o=c.SORT_VALUE.DESC):(e=c.SORT_KEY.PRICE,o=c.SORT_VALUE.ASC):(e=c.SORT_KEY.PRICE,o=c.SORT_VALUE.DESC),e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,v())}function f(){var e=c.SORT_KEY.CREDIT,o=c.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,v())}function m(t){i.go("product",{product:t.id})}function v(){t.isProductsLoading||(t.products=null,t.isProductsEmpty=!1,t.isProductsLoaded=!1,y(1,_))}function S(){t.isProductsLoading||t.isProductsLastPage||(t.products&&t.products.length?y(t.products.length/_+1,_):y(1,_))}function y(e,o){t.isProductsLoading=!0;var n={};t.currentCategory&&(n.category=t.currentCategory),t.currentKeyword&&(n.keyword=t.currentKeyword),t.brand&&(n.brand=t.brand),n.sort_key=t.currentSortKey,n.sort_value=t.currentSortValue,n.page=e,n.per_page=o,a.product.list(n).then(function(e){t.products=t.products?t.products.concat(e):e,t.isProductsEmpty=!t.products||!t.products.length,t.isProductsLoaded=!0,t.isProductsLoading=!1,t.isProductsLastPage=e&&e.length<o?!t.isProductsEmpty:!1})}function $(){t.showTypeChose?t.showTypeChose=0:t.showTypeChose=1}function A(){t.showTypeChose=0}function E(){t.isShopsLoading||(t.shops=null,t.isShopsEmpty=!1,t.isShposLoaded=!1,T(1,_))}function T(e,o){t.isShopsLoading=!0;var n={};t.currentCategory&&(n.category=t.currentCategory),t.currentKeyword&&(n.keyword=t.currentKeyword),t.brand&&(n.brand=t.brand),n.sort_key=t.currentSortKey,n.sort_value=t.currentSortValue,n.page=e,n.per_page=o,a.shop.shopList(n).then(function(e){t.shops=t.shops?t.shops.concat(e):e,t.isShopsEmpty=!t.shops||!t.shops.length,t.isShopsLoaded=!0,t.isShopsLoading=!1,t.isShopsLastPage=e&&e.length<o?!t.isShopsEmpty:!1})}function P(){var e=c.SORT_KEY.POPULAR,o=c.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,E())}function L(){t.isShopsLoading||t.isShposLastPage||(t.shops&&t.shops.length?y(t.shops.length/_+1,_):y(1,_))}function C(){var e=c.SORT_KEY.CREDIT,o=c.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,E())}function w(t){i.go("shop-home",{shop:t.id})}function M(e){e?(t.isSearchGoods=1,v()):(t.isSearchGoods=0,E())}var _=10;t.currentSortKey=s.sortKey?s.sortKey:c.SORT_KEY.DEFAULT,t.currentSortValue=s.sortValue?s.sortValue:c.SORT_KEY.DESC,t.currentKeyword=s.keyword?s.keyword:null,t.currentCategory=s.category,t.brand=s.brand,s.isSearchGoods?t.isSearchGoods=parseInt(s.isSearchGoods):t.isSearchGoods=1,t.isB2B2C=u.getPlatform().type,t.navTitle=s.navTitle,t.navStyle=s.navStyle,t.navStyle||(t.navStyle="default"),t.products=null,t.touchSearch=l,t.touchSortDefault=d,t.touchSortSale=p,t.touchSortDate=h,t.touchSortPrice=g,t.touchSortCredit=f,t.touchProduct=m,t.loadMoreProducts=S,t.isProductsEmpty=!1,t.isProductsLoaded=!1,t.isProductsLoading=!1,t.isProductsLastPage=!1,t.showTypeChose=0,t.touchTypeChose=$,t.hideTypeChose=A,t.shops=null,t.isShopsEmpty=!1,t.isShopsLoaded=!1,t.isShopsLoading=!1,t.isShopsLastPage=!1,t.touchShopSortPopular=P,t.touchShopSortCredit=C,t.loadMoreShops=L,t.touchShop=w,t.choseType=M,t.isSearchGoods?v():E()}angular.module("app").controller("SearchResultController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("search-result",{needAuth:!1,url:"/search-result/?keyword&sortKey&sortValue&category&navTitle&navStyle&brand&isSearchGoods",title:"搜索结果",templateUrl:"modules/search-result/search-result.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l,d,p){function h(){i.go("shop-list",{sortKey:c.SORT_KEY.DATE,sortValue:c.SORT_VALUE.DESC,shop:t.product.shop,navTitle:"最新商品",navStype:"newProduct"})}function g(){i.go("shop-list",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,shop:t.product.shop,navTitle:"全部商品",navStype:"allProduct"})}function f(){i.go("shop-list",{sortKey:c.SORT_KEY.SALE,sortValue:c.SORT_VALUE.DESC,shop:t.product.shop,navTitle:"热销商品",navStype:"hotProduct"})}function m(){t.showTel=!1}function v(){window.location.href="tel:"+t.shop.tel,t.showTel=!1}function S(){t.showTel=!0}function y(){if(_()&&t.product&&(!t.product.stock||!t.product.stock.length||t.currentStock)){var e=parseInt(t.input.currentAmount);return 1>=e?void t.toast("受不了了，宝贝不能再少了"):void(t.input.currentAmount=""+(e-1))}}function $(){if(_()&&t.product){var e=t.input.currentAmount;if(isNaN(e))return e=1,void(t.input.currentAmount=e);if(t.product.stock&&t.product.stock.length){if(!t.currentStock)return;var e=parseInt(t.input.currentAmount),o=parseInt(t.currentStock.stock_number);if(o>=e)return;isNaN(e)&&(e=1),e>o&&(e=o),1>=e&&(e=1),t.input.currentAmount=e}else{var e=parseInt(t.input.currentAmount),o=parseInt(t.product.good_stock);if(o>=e)return;isNaN(e)&&(e=1),e>o&&(e=o),1>=e&&(e=1),t.input.currentAmount=e}}}function A(){if(_()&&t.product)if(t.product.stock&&t.product.stock.length){if(!t.currentStock)return;var e=parseInt(t.input.currentAmount),o=parseInt(t.currentStock.stock_number);if(e>=o)return;t.input.currentAmount=""+(e+1)}else{var e=parseInt(t.input.currentAmount),o=t.product.good_stock;if(e>=o)return;t.input.currentAmount=""+(e+1)}}function E(e,o){if(t.product){var n=t.product;if(o.is_multiselect){for(var r=[].concat(t.optionalAttrs),i=-1,s=0;s<r.length;++s)r[s].propertiesId==e.id&&r[s].attributeId&&(i=s);-1==i?r.push({propertiesId:e.id,attributeId:o.id}):r.splice(i,1),t.optionalAttrs=r,_refreshPrice()}else{var a=null,r=[].concat(t.currentAttrs),c=!0;for(var s in r){var u=r[s];if(u.propertiesId==e.id&&u.attributeId==o.id)return void(c=!1);c=!0}if(!c)return;r.push({propertiesId:e.id,attributeId:o.id});for(var s in e.attrs)if(e.attrs[s].id!=o.id){for(var i=-1,l=0;l<r.length;++l)r[l].propertiesId==e.id&&r[l].attributeId==e.attrs[s].id&&(i=l);-1!=i&&r.splice(i,1)}if(r=r.filter(function(t,e,o){return o.indexOf(t)===e}),t.isB2B2C?r.sort(function(t,e){return t.propertiesId-e.propertiesId}):r.sort(function(t,e){return t.attributeId-e.attributeId}),r.length){for(var d=[],s=0;s<r.length;++s)d.push(r[s].attributeId);for(var p=d.join("|"),s=0;s<n.stock.length;++s)if(n.stock[s].goods_attr==p){a=n.stock[s];break}}t.currentAttrs=r,t.currentStock=a,t.canPurchase=_()}}}function T(){i.go("comment",{product:V})}function P(t){i.go("comment",{product:V})}function L(){return u.getToken()?void i.go("cart",{}):void t.goSignin()}function C(){return u.getToken()?void(t.product.is_liked?(t.product.is_liked=!1,a.product.unlike({product:V}).then(function(e){t.product.is_liked=e,t.toast("取消收藏")},function(e){t.product.is_liked=!0})):(t.product.is_liked=!0,a.product.like({product:V}).then(function(e){t.product.is_liked=e,t.toast("收藏成功")},function(e){t.product.is_liked=!1}))):void t.goSignin()}function w(){if(_()){if(!u.getToken())return void t.goSignin();for(var e=[].concat(t.currentAttrs).concat(t.optionalAttrs),o=t.input.currentAmount,n=[],r=0;r<e.length;++r)n.push(e[r].attributeId);d.add(V,n,o).then(function(e){e&&t.toast("已添加到购物车")})}}function M(){if(_()){if(!u.getToken())return void t.goSignin();for(var e=t.product,o=[].concat(t.currentAttrs).concat(t.optionalAttrs),n=t.input.currentAmount,r=[],s=0;s<o.length;++s)r.push(o[s].attributeId);l.clear(),l.product=e,l.attrs=r,l.amount=n,i.go("confirm-product",{shopId:t.product.shop})}}function _(){var e=t.product,o=!1;if(!e||!e.good_stock)return!1;for(var n in e.properties)if(!e.properties[n].is_multiselect){o=!0;break}if(o){if(!t.currentAttrs||!t.currentAttrs.length)return!1;if(!t.currentStock)return!1;if(0==t.currentStock.stock_number)return!1}return!0}function b(t){return c.REVIEW_GRADE.BAD==t?"差评":c.REVIEW_GRADE.MEDIUM==t?"中评":c.REVIEW_GRADE.GOOD==t?"好评":"中评"}function I(e,o){({propertiesId:e.id,attributeId:o.id});if(o.is_multiselect){for(var n=0;n<t.optionalAttrs.length;++n){var r=t.optionalAttrs[n];if(r.propertiesId==e.id&&r.attributeId==o.id)return!0}return!1}for(var n=0;n<t.currentAttrs.length;++n){var i=t.currentAttrs[n];if(i.propertiesId==e.id&&i.attributeId==o.id)return!0}return!1}function U(){var e=t.product.shop;a.shop.shopInfo({shop:e}).then(function(e){t.shop=e})}function R(){t.isLoading=!0,a.product.get({product:V}).then(function(e){if(e.properties.sort(function(t,e){return t.is_multiselect-e.is_multiselect}),t.product=e,t.isLoaded=!0,t.isLoading=!1,t.canPurchase=_(),t.isB2B2C&&U(),p.fetch().then(function(){var t=p.getConfig(),o=t["wxpay.web"];return D(o,e.share_url),!0}),e.photos&&e.photos.length>1){n(function(){t.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1)}else{n(function(){t.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!1,spaceBetween:30,centeredSlides:!0,autoplay:0,autoplayDisableOnInteraction:!1,loop:!1})},1)}for(var o=[],r=null,i=0;i<e.properties.length;++i){var s=e.properties[i];if(!s.is_multiselect){var a={propertiesId:s.id,attributeId:s.attrs[0].id};o.push(a)}}if(t.isB2B2C?o.sort(function(t,e){return t.propertiesId-e.propertiesId}):o.sort(function(t,e){return t.attributeId-e.attributeId}),o.length){for(var a=[],i=0;i<o.length;++i)a.push(o[i].attributeId);for(var c=a.join("|"),i=0;i<e.stock.length;++i)if(e.stock[i].goods_attr==c){r=e.stock[i];break}}t.currentAttrs=o,t.currentStock=r,t.canPurchase=_(),B()})}function D(t,e){if(u.getToken()&&t){wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:t.app_id,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]});var o=e;wx.ready(function(){wx.onMenuShareTimeline({title:"商品详情",desc:"",link:o,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:"商品详情",desc:"",link:o,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:"商品详情",desc:"",link:o,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:"商品详情",desc:"",link:o,imgUrl:"",success:function(){},cancel:function(){}})}),wx.error(function(t){GLOBAL_CONFIG.DEBUG&&$rootScope.toast(JSON.stringify(t))})}}function O(){i.go("shop-home",{shop:t.product.shop})}function B(){t.product&&a.review.productList({
product:V,grade:c.REVIEW_GRADE.ALL,page:1,per_page:N}).then(function(e){t.comments=e})}function k(){R()}var N=3,V=s.product;p.fetch(),a.config.get().then(function(e){t.isB2B2C=e.platform.type}),t.currentStock=null,t.currentAttrs=[],t.currentSelectedPrice=0,t.input={currentAmount:1},t.optionalAttrs=[],t.canPurchase=!1,t.product=null,t.comments=[],t.showTel=!1,t.cartModel=d,t.touchAmountSub=y,t.touchAmountAdd=A,t.touchAttr=E,t.touchLike=C,t.touchComments=T,t.touchComment=P,t.touchCart=L,t.touchAddCart=w,t.touchPurchase=M,t.refreshAmount=$,t.touchShop=O,t.touchShopNewProduct=h,t.touchShopAllProduct=g,t.touchShopHotProduct=f,t.touchCallTel=S,t.touchTelCanel=m,t.touchTelSure=v,t.formatGrade=b,t.isAttrSelected=I,t.reloadShop=U,t.shop=null,t.isLoading=!1,t.isLoaded=!1;var j=p.getPlatform();t.isB2B2C=j.type,k()}angular.module("app").controller("ProductController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","ConfirmProductService","CartModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("product",{needAuth:!1,url:"/product/?product",title:"商品详情",templateUrl:"modules/product/product.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){t.currentTab=t.TAB_ALL,v()}function d(){t.currentTab=t.TAB_BAD,v()}function p(){t.currentTab=t.TAB_MEDIUM,v()}function h(){t.currentTab=t.TAB_GOOD,v()}function g(t){return c.REVIEW_GRADE.BAD==t?"差评":c.REVIEW_GRADE.MEDIUM==t?"中评":c.REVIEW_GRADE.GOOD==t?"好评":"中评"}function f(){t.isLoading||t.isLastPage||(t.comments&&t.comments.length?m(t.comments.length/S+1,S):m(1,S))}function m(e,o){var n=c.REVIEW_GRADE.ALL;t.currentTab==t.TAB_ALL?n=c.REVIEW_GRADE.ALL:t.currentTab==t.TAB_BAD?n=c.REVIEW_GRADE.BAD:t.currentTab==t.TAB_MEDIUM?n=c.REVIEW_GRADE.MEDIUM:t.currentTab==t.TAB_GOOD&&(n=c.REVIEW_GRADE.GOOD),t.isLoading=!0,a.review.productList({product:y,grade:n,page:e,per_page:o}).then(function(e){t.comments=t.comments?t.comments.concat(e):e,t.isEmpty=!t.comments||!t.comments.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=e&&e.length<o?!t.isEmpty:!1})}function v(){t.isLoading||(t.comments=null,t.isEmpty=!1,t.isLoaded=!1,m(1,S))}var S=10,y=s.product,$=u.getPlatform();t.isB2B2C=$.type,t.TAB_ALL=0,t.TAB_BAD=1,t.TAB_MEDIUM=2,t.TAB_GOOD=3,t.currentPage=0,t.currentTab=t.TAB_ALL,t.comments=null,t.touchTabAll=l,t.touchTabBad=d,t.touchTabMedium=p,t.touchTabGood=h,t.loadMore=f,t.formatGrade=g,t.isEmpty=!1,t.isLoaded=!1,t.isLoading=!1,t.isLastPage=!1,v()}angular.module("app").controller("CommentController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("comment",{needAuth:!1,url:"/comment/?product",title:"商品评价",templateUrl:"modules/comment/comment.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){function s(){this.goods=[],this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}}var a={};return a.goods=[],a.invoiceType=null,a.invoiceTitle=null,a.invoiceContent=null,a.express=null,a.cashgift=null,a.consignee=null,a.coupon=null,a.clear=s,a.input={score:0,comment:""},n.$on("consigneeChanged",function(t,e){a.consignee=e}),n.$on("expressChanged",function(t,e){a.express=e}),n.$on("invoiceChanged",function(t,e){a.invoiceTitle=e.title,a.invoiceType=e.type,a.invoiceContent=e.content}),n.$on("cashgiftChanged",function(t,e){a.cashgift=e}),a}angular.module("app").factory("ConfirmCartService",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l,d,p,h){function g(){n.go("address-select",{address:t.consignee?t.consignee.id:null})}function f(){var e=t.goods,o=0;for(var r in e)o+=e[r].price*e[r].amount;n.go("coupon-select",{shopId:t.shop.id,totalPrice:o})}function m(){if(!t.consignee)return void t.toast("请选择地址");var e=t.goods,o=[],r=[];if(!e||!e.length)return void t.toast("商品信息不存在");for(var i=0;i<e.length;++i)o.push(e[i].product.id),r.push(e[i].amount);l.clear(),l.expressId=t.express?t.express.id:null,l.goodsIds=o,l.goodsNumbers=r,l.region=t.consignee.id,l.shopId=e[0].product.shop,n.go("express-select",{})}function v(){d.clear(),d.type=t.invoiceType?t.invoiceType:null,d.title=t.invoiceTitle,d.content=t.invoiceContent?t.invoiceContent:null,n.go("invoice-select",{})}function S(){var e=t.goods,o=(t.consignee,t.express,t.cashgift),r=0;for(var i in e)r+=e[i].price;n.go("cashgift-select",{cashgift:o?o.id:null,total:r})}function y(){var e=t.goods,o=t.consignee,r=t.express,i=t.coupon,s=t.cashgift,c=t.input.score,d=t.input.comment,h=t.invoiceType,g=t.invoiceTitle,f=t.invoiceContent,m=[];if(!e||!e.length)return void t.toast("商品信息不存在");for(var v=0;v<e.length;++v)m.push(e[v].id);if(!m||!m.length)return void t.toast("商品信息不存在");if(!o)return void t.toast("请填写地址");if(!r)return void t.toast("请选择快递");var S={shop:e[0].product.shop,consignee:o?o.id:null,cart_good_id:m?JSON.stringify(m):null,shipping:r?r.id:null,invoice_type:h?h.id:null,invoice_title:g,invoice_content:f?f.id:null,coupon:i?i.id:null,cashgift:s?s.id:null,score:c,comment:d};S.coupon||delete S.coupon,a.cart.checkout(S).then(function(t){t&&(u.clear(),l.clear(),p.clear(),p.order=t,n.go("payment",{order:t.id}))})}function $(){return t.goods&&t.goods.length&&t.consignee?!!t.express:!1}function A(t){return"score"==t?"积分":"cashgift"==t?"红包":"preferential"==t?"优惠金额":"goods_reduction"==t?"商品减免":"order_reduction"==t?"订单减免":"coupon_reduction"==t?"优惠券减免":"其他优惠"}function E(){var e=t.goods,o=0;for(var n in e)o+=e[n].price*e[n].amount;var r={shop:t.shop.id,total_price:o,page:1,per_page:10};a.coupon.available(r).then(function(e){t.coupons=e.coupons,t.couponCount=e.paged.total,t.coupon&&t.coupon.name&&(t.couponCount=t.coupon.name)})}function T(){var e={};a.consignee.list(e).then(function(e){if(e&&(t.consigneeList=e,!t.consignee))for(var o in t.consigneeList)t.consigneeList[o].is_default&&(t.consignee=t.consigneeList[o],r.$emit("consigneeChanged",t.consignee))})}function P(){t.maxUseScore=0;for(var e=0;e<t.goods.length;++e)t.maxUseScore+=t.goods[e].product.score*t.goods[e].amount}function L(){t.timer&&(i.cancel(t.timer),t.timer=null),t.timer=i(function(){var e=t.scoreInfo.score>t.maxUseScore?t.maxUseScore:t.scoreInfo.score;t.input.score>e&&(t.input.score=e),t.input.score<0&&(t.input.score=0),u.input.score=t.input.score,w(),t.timer=null},200)}function C(){u.input.comment=t.input.comment}function w(){var e=t.goods,o=t.consignee,n=t.express,r=t.coupon,i=t.cashgift,s=t.input.score;if(!e||!e.length)return void t.toast("商品信息不存在");if(o){var c=[];if(t.isB2B2C)for(var u=0;u<e.length;++u)c.push({goods_id:e[u].product.id,property:e[u].attrs,num:e[u].amount});else for(var u=0;u<e.length;++u)c.push({goods_id:e[u].product.id,property:e[u].attrs.split(","),num:e[u].amount});var l={};l.order_product=JSON.stringify(c),l.shop=e[0].product.shop,o&&(l.consignee=o.id),n&&(l.shipping=n.id),i&&(l.cashgift=i.id),r&&(l.coupon=r.id),s&&(l.score=s),a.order.price(l).then(function(e){t.priceInfo=e,t.all_discount=e.discount_price;for(var o in e.promos)t.all_discount+=parseFloat(e.promos[o].price)})}}function M(){w(),P(),T(),t.isCouponEnable&&E()}return u.goods&&u.goods.length?(t.isB2B2C=h.getPlatform().type,t.isCashgiftEnable=h.getFeature().cashgift,t.isCouponEnable=h.getFeature().coupon,t.isInvoiceEnable=h.getFeature().invoice,t.isScoreEnable=h.getFeature().score,t.touchAddress=g,t.touchExpress=m,t.touchInvoice=v,t.touchCashgift=S,t.touchSubmit=y,t.refreshScore=L,t.refreshComment=C,t.touchCoupon=f,t.goods=u.goods,t.consignee=u.consignee,t.invoiceType=u.invoiceType,t.invoiceTitle=u.invoiceTitle,t.invoiceContent=u.invoiceContent,t.cashgift=u.cashgift,t.express=u.express,t.coupon=u.coupon,t.shop=u.shop,t.couponCount="0",t.coupon&&t.coupon.name&&(t.couponCount=t.coupon.name),t.all_discount=0,t.input={score:0,comment:""},t.input.score=u.input.score,0==t.input.score&&(t.input.score=""),t.input.comment=u.input.comment,t.scoreInfo=null,t.priceInfo=null,t.canPurchase=$(),t.maxUseScore=0,t.formatPromo=A,void M()):void i(function(){r.goHome()},1)}angular.module("app").controller("ConfirmCartController",t),t.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","ConfirmCartService","ExpressSelectService","InvoiceSelectService","PaymentModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("confirm-cart",{needAuth:!0,url:"/confirm-cart",templateUrl:"modules/confirm-cart/confirm-cart.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){function s(){this.product=null,this.properties=null,this.amount=null,this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}}var a={};return a.product=null,a.properties=null,a.amount=null,a.invoiceType=null,a.invoiceTitle=null,a.invoiceContent=null,a.shippingVendor=null,a.cashgift=null,a.consignee=null,a.coupon=null,a.express=null,a.clear=s,a.input={score:0,comment:""},i.$on("consigneeChanged",function(t,e){a.consignee=e}),i.$on("expressChanged",function(t,e){a.express=e}),i.$on("invoiceChanged",function(t,e){a.invoiceTitle=e.title,a.invoiceType=e.type,a.invoiceContent=e.content}),i.$on("cashgiftChanged",function(t,e){a.cashgift=e}),a}angular.module("app").factory("ConfirmProductService",t),t.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){e.go("address-select",{address:t.consignee?t.consignee.id:null})}function d(){if(!t.consignee)return void t.toast("请选择地址");var o=[],n=[];for(var r in t.selectedGoods){var i=t.selectedGoods[r];o.push(i.product.id),n.push(i.amount)}s.clear(),s.expressId=t.express?t.express.id:null,s.goodsIds=o,s.goodsNumbers=n,s.region=t.consignee.id,s.shopId=t.selectedGoods[0].product.shop,e.go("express-select",{})}function p(){a.clear(),a.type=t.invoiceType?t.invoiceType:null,a.title=t.invoiceTitle,a.content=t.invoiceContent?t.invoiceContent:null,e.go("invoice-select",{})}function h(){e.go("coupon-select",{totalPrice:t.totalPrice,shopId:t.shopId})}function g(){e.go("cashgift-select",{cashgift:t.cashgift?t.cashgift.id:null,total:t.priceInfo?t.priceInfo.product_price:0})}function f(){return t.selectedGoods&&t.selectedGoods.length&&t.consignee?!!t.express:!1}function m(t){return"score"==t?"积分":"cashgift"==t?"红包":"preferential"==t?"优惠金额":"goods_reduction"==t?"商品减免":"order_reduction"==t?"订单减免":"coupon_reduction"==t?"优惠券减免":"其他优惠"}function v(){var e={};r.consignee.list(e).then(function(e){if(e&&(t.consigneeList=e,!t.consignee)){for(var n in t.consigneeList)t.consigneeList[n].is_default&&(t.consignee=t.consigneeList[n],o.$emit("consigneeChanged",t.consignee));E()}})}function S(){t.maxUseScore=0;for(var e=0;e<t.selectedGoods.length;++e)t.maxUseScore+=t.selectedGoods[e].product.score*t.selectedGoods[e].amount}function y(){var e={shop:t.shopId,total_price:t.totalPrice,page:1,per_page:10};r.coupon.available(e).then(function(e){t.coupons=e.coupons,t.coupon&&t.coupon.name?t.couponCount=t.coupon.name:t.couponCount=e.paged.total})}function $(){var e=t.scoreInfo.score>t.maxUseScore?t.maxUseScore:t.scoreInfo.score;t.input.score>e&&(t.input.score=e),t.input.score<0&&(t.input.score=0),i.input.score=t.input.score,E()}function A(){i.input.comment=t.input.comment}function E(){if(t.consignee&&t.express){var e=[];for(var o in t.selectedGoods){var n=t.selectedGoods[o],i={goods_id:n.product.id,property:n.attrs,num:n.amount,total_amount:n.amount};e.push(i)}var s={};s.order_product=JSON.stringify(e),t.consignee&&(s.consignee=t.consignee.id),t.express&&(s.shipping=t.express.id),t.cashgift&&(s.cashgift=t.cashgift.id),t.coupon&&(s.coupon=t.coupon.id),t.input.score&&(s.score=t.input.score),s.shop=n.product.shop,r.order.price(s).then(function(e){if(e){t.priceInfo=e,t.all_discount=e.discount_price;for(var o in e.promos)t.all_discount+=parseFloat(e.promos[o].price)}})}}function T(){var o=t.consignee,n=t.express;if(!o)return void t.toast("请填写地址");if(!n)return void t.toast("请选择快递");var a={};for(var u in t.selectedGoods){var l=t.selectedGoods[u];a.product=l.product.id,a.property=JSON.stringify(l.attrs),a.amount=l.amount}t.consignee&&(a.consignee=t.consignee.id),t.express&&(a.shipping=t.express.id),t.cashgift&&(a.cashgift=t.cashgift.id),t.input.score&&(a.score=t.input.score),t.invoiceContent&&(a.invoice_content=t.invoiceContent.id),t.invoice&&(a.invoice_type=t.invoiceType.id),t.invoiceTitle&&(a.invoice_title=t.invoiceTitle),t.input.comment&&(a.comment=t.input.comment),t.coupon&&(a.coupon=t.coupon.id),a.shop=l.product.shop,r.product.purchase(a).then(function(t){t&&(i.clear(),s.clear(),c.clear(),c.order=t,e.go("payment",{order:t.id}))})}if(t.isB2B2C=u.getPlatform().type,t.isCashgiftEnable=u.getFeature().cashgift,t.isCouponEnable=u.getFeature().coupon,t.isInvoiceEnable=u.getFeature().invoice,t.isScoreEnable=u.getFeature().score,t.touchAddress=l,t.touchExpress=d,t.touchInvoice=p,t.touchCashgift=g,t.touchCoupon=h,t.touchSubmit=T,t.refreshScore=$,t.refreshComment=A,t.shopId=n.shopId,t.totalPrice=0,t.consigneeList=[],t.consignee=i.consignee,t.invoiceType=i.invoiceType,t.invoiceTitle=i.invoiceTitle,t.invoiceContent=i.invoiceContent,t.cashgift=i.cashgift,t.express=i.express,t.coupon=i.coupon,t.couponCount="0",t.coupon&&t.coupon.name&&(t.couponCount=t.coupon.name),t.all_discount=0,t.input={score:0,comment:""},t.input.score=i.input.score,t.input.comment=i.input.comment,0==t.input.score&&(t.input.score=""),t.rule="",t.scoreInfo=null,t.priceInfo={},t.formatPromo=m,t.maxUseScore=0,t.selectedGoods=[],i.product){var P={};P.product=i.product;var L=i.attrs;P.property="",P.attrs=[];for(var C=parseFloat(P.product.current_price),w=L.length,M=0;w>M;M++)for(var _=P.product.properties.length,b=0;_>b;b++)for(var I=P.product.properties[b],w=I.attrs.length,U=0;w>U;U++){var R=I.attrs[U];parseInt(R.id)==L[M]&&(P.property.length>0?P.property+=","+R.attr_name:P.property=R.attr_name,P.attrs.push(R.id),parseFloat(R.attr_price)&&(C+=parseFloat(R.attr_price)))}P.amount=i.amount,P.price=C,t.totalPrice=C*i.amount,t.selectedGoods.push(P),t.canPurchase=f(),v(),S(),E(),t.isCouponEnable&&y()}}angular.module("app").controller("ConfirmController",t),t.$inject=["$scope","$state","$rootScope","$stateParams","API","ConfirmProductService","ExpressSelectService","InvoiceSelectService","PaymentModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("confirm-product",{needAuth:!0,url:"/confirm-product?shopId",title:"确认订单",templateUrl:"modules/confirm-product/confirm-product.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){this.order=null}function u(t){if(i.getToken()){var e=this;return s.payment.typeList({shop:t.shop.id}).then(function(t){return t&&(e.types=t,e.isEmpty=!e.groups||!e.groups.length,e.isLoaded=!0,e.isLoading=!1),!!t})}}var l={};return l.isEmpty=!1,l.isLoaded=!1,l.isLoading=!1,l.types=null,l.order=null,l.reload=u,l.clear=c,l}angular.module("app").factory("PaymentModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l){function d(e){return t.selectedType?e.code==t.selectedType.code:!1}function p(t){return"wxpay.web"===t.code?!!g():!0}function h(e){t.selectedType=e}function g(){if(!l.FOR_WEIXIN)return!1;var t=navigator.userAgent.toLowerCase()||navigator.vendor.toLowerCase();return"micromessenger"==t.match(/MicroMessenger/i)}function f(){if(!t.selectedType)return void t.toast("请选择支持方式");switch(t.selectedType.code){case"alipay.app":case"alipay.wap":n.go("alipay-wap",{order:u.order.id});break;case"wxpay.app":case"wxpay.web":r.isWeixin()?n.go("wechat-pay",{order:u.order.id}):t.toast("暂不支持此方式");break;case"unionpay.app":t.toast("暂不支持此方式");break;case"teegon.wap":n.go("teegon",{order:u.order.id});break;default:t.toast("暂不支持此方式")}}function m(){n.go("order-detail",{order:t.paymentModel.order.id})}function v(){t.paymentModel.reload(t.paymentModel.order).then(function(t){}),t.isWeixin=g()}return u.order?(t.selectedType=null,t.paymentModel=u,t.isSelected=d,t.touchSelect=h,t.touchSubmit=f,t.touchDetail=m,t.isShowType=p,void v()):void i(function(){r.goHome()},1)}angular.module("app").controller("PaymentController",t),t.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel","CONSTANTS"]}(),function(){"use strict";function t(t,e){t.state("payment",{needAuth:!1,url:"/payment",title:"收银台",templateUrl:"modules/payment/payment.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=r.order;t.touchDetail=function(){n.go("order-detail",{order:i})}}angular.module("app").controller("PaymentSuccessController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("payment-success",{needAuth:!0,url:"/payment-success?order",title:"付款成功",templateUrl:"modules/payment-success/payment-success.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=r.order;t.reason=r.reason,t.touchDetail=function(){n.go("order-detail",{order:i})}}angular.module("app").controller("PaymentFailedController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("payment-failed",{needAuth:!0,url:"/payment-failed?order&reason",title:"支付失败",templateUrl:"modules/payment-failed/payment-failed.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){function s(){this.title=null,this.type=null,this.content=null}var a={};return a.title=null,a.type=null,a.content=null,a.clear=s,a}angular.module("app").factory("InvoiceSelectService",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(e){t.selectedType=e,t.noInvoice=!1}function u(e){t.selectedContent=e,t.noInvoice=!1}function l(){if(t.noInvoice)o.$emit("invoiceChanged",{title:null,type:null,content:null}),t.goBack();else{if(!t.types)return void t.toast("请选择发票类型");if(!t.contents)return void t.toast("请选择发票明细");if(!t.input.title||!t.input.title.length)return void t.toast("请填写发票抬头");o.$emit("invoiceChanged",{title:t.input.title,type:t.selectedType,content:t.selectedContent}),t.goBack()}}function d(){t.noInvoice=!t.noInvoice,t.noInvoice&&(t.input.title=null,t.selectedType=null,t.selectedContent=null)}function p(){i.invoice.typeList({}).then(function(e){for(var o=new Array,n=0;n<e.length;n++){var r=e[n];r.name.length&&o.push(r)}t.types=o;var i=t.selectedType;if(i)for(var n=0;n<e.length;++n)if(e[n].id==i.id){t.selectedType=e[n];break}t.noInvoice=g()})}function h(){i.invoice.contentList({}).then(function(e){t.contents=e;var o=t.selectedContent;if(o)for(var n=0;n<e.length;++n)if(e[n].id==o.id){t.selectedContents=e[n];break}t.noInvoice=g()})}function g(){return t.input.title&&t.input.title.length?!1:t.selectedType?!1:!t.selectedContent}function f(){p(),h()}t.input={title:a.title},t.selectedType=a.type,t.selectedContent=a.content,t.types=null,t.contents=null,t.touchType=c,t.touchContent=u,t.touchConfirm=l,t.touchToggle=d,t.noInvoice=g(),f()}angular.module("app").controller("InvoiceSelectController",t),t.$inject=["$scope","$http","$rootScope","$stateParams","$state","API","ENUM","InvoiceSelectService"]}(),function(){"use strict";function t(t,e){t.state("invoice-select",{needAuth:!0,url:"/invoice-select",title:"发票信息",templateUrl:"modules/invoice-select/invoice-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i){function s(){this.expressId=null,this.goodsIds=null,this.goodsNumbers=null,this.region=null,this.shopId=null}var a={};return a.expressId=null,a.goodsIds=null,a.goodsNumbers=null,a.region=null,a.shopId=null,a.clear=s,a}angular.module("app").factory("ExpressSelectService",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(e){n.$emit("expressChanged",e),t.goBack()}function l(){for(var e=t.goodsIds,o=t.goodsNumbers,n=[],r=0;r<e.length&&r<o.length;++r)n.push({goods_id:e[r],num:o[r]});var i=[];for(var a in t.selectedGoods){var c=t.selectedGoods[a],u={goods_id:c.product.id,num:c.amount};i.push(u)}s.shipping.vendorList({shop:t.shopId,products:JSON.stringify(n),address:t.region}).then(function(e){t.vendors=e})}t.selectedId=c.expressId||null,t.goodsIds=c.goodsIds||[],t.goodsNumbers=c.goodsNumbers||[],t.region=c.region||null,t.shopId=c.shopId,t.vendors=[],t.touchVendor=u,l()}angular.module("app").controller("ExpressSelectController",t),t.$inject=["$scope","$http","$window","$rootScope","$state","$stateParams","API","ENUM","ExpressSelectService"]}(),function(){"use strict";function t(t,e){t.state("express-select",{needAuth:!0,url:"/express-select",title:"配送方式",templateUrl:"modules/express-select/express-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){this.cashgifts=null,this.totalPrice=0}function u(){a.getToken()&&(this.isLoading||(this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.fetch(1,p)))}function l(){a.getToken()&&(this.isLoading||this.isLastPage||(this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/p+1,p):this.fetch(1,p)))}function d(t,e){if(a.getToken()){this.isLoading=!0;var o=this;i.cashgift.available({total_price:this.totalPrice,page:t,per_page:e}).then(function(t){o.cashgifts=o.cashgifts?o.cashgifts.concat(t):t,o.isEmpty=!o.cashgifts||!o.cashgifts.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=t&&t.length<e?!o.isEmpty:!1})}}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.cashgifts=null,h.totalPrice=0,h.clear=c,h.fetch=d,h.reload=u,h.loadMore=l,h}angular.module("app").factory("CashgiftSelectModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){t.selectedId=null}function d(e){t.selectedId=e.id}function p(){var e=null,o=t.cashgiftSelectModel.cashgifts;for(var n in o)if(o[n].id==t.selectedId){e=o[n];break}r.$emit("cashgiftChanged",e),t.goBack()}t.selectedId=i.cashgift||null,t.totalPrice=i.total||0,t.cashgiftSelectModel=u,t.cashgiftSelectModel.clear(),t.cashgiftSelectModel.totalPrice=t.totalPrice,t.touchClear=l,t.touchCashgift=d,t.touchConfirm=p,t.cashgiftSelectModel.reload()}angular.module("app").controller("CashgiftSelectController",t),t.$inject=["$scope","$http","$location","$timeout","$rootScope","$stateParams","$state","API","ENUM","CashgiftSelectModel"]}(),function(){"use strict";function t(t,e){t.state("cashgift-select",{needAuth:!0,url:"/cashgift-select?cashgift&total",title:"选择红包",templateUrl:"modules/cashgift-select/cashgift-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s){function a(){this.consignees=null}function c(){this.isLoading=!1,this.isLoaded=!1;var t=this;return i.consignee.list({}).then(function(e){t.consignees=e,t.isLoading=!1,t.isLoaded=!0})}var u={};return u.isLoading=!1,u.isLoaded=!1,u.consignees=null,u.clear=a,u.reload=c,u}angular.module("app").factory("AddressSelectModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(){t.addressEditModel.clear(),t.addressEditModel.consignee=null,r.go("address-edit",{})}function l(e){t.addressEditModel.clear(),t.addressEditModel.consignee=e,r.go("address-edit",{})}function d(e){n.$emit("consigneeChanged",e),t.goBack()}t.selectedId=o.address,t.addressSelectModel=c,t.touchCreate=u,t.touchModify=l,t.touchConsignee=d,t.addressEditModel=a,t.addressSelectModel.clear(),t.addressSelectModel.reload()}angular.module("app").controller("AddressSelectController",t),t.$inject=["$scope","$http","$stateParams","$rootScope","$state","API","ENUM","AddressEditModel","AddressSelectModel"]}(),function(){"use strict";function t(t,e){t.state("address-select",{needAuth:!0,url:"/address-select?address",title:"选择地址",templateUrl:"modules/address-select/address-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){this.consignee=null}function u(t,e,o,n){if(a.getToken()){if(this.consignee&&this.consignee.id){var r=this;return i.consignee.update({consignee:this.consignee.id,name:t,mobile:e,tel:"",zip_code:"",region:o,address:n}).then(function(t){return r.consignee=t,!!t})}var r=this;return i.consignee.add({name:t,mobile:e,tel:"",zip_code:"",region:o,address:n}).then(function(t){return r.consignee=t,!!t})}}function l(){if(a.getToken()&&!this.isLoading){this.isLoading=!0;var t=this;return i.region.list({}).then(function(e){return e&&e.length?(t.isLoading=!1,t.isLoaded=!0,t.regions=e):n.toast("没有可选地址"),!!e})}}function d(){if(a.getToken()){if(this.isLoaded){var t=e.defer();return o(function(){t.resolve(!0)},1),t.promise}return this.reload()}}var p={};return p.isLoaded=!1,p.isLoading=!1,p.consignee=null,p.regions=null,p.save=u,p.clear=c,p.reload=l,p.reloadIfNeeded=d,p}angular.module("app").factory("AddressEditModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(){t.goBack()}function l(){var e=t.name,o=t.mobile,n=t.address,r=t.regions;if(!e||e.length<2)return void t.toast("请输入姓名");if(!o||o.length<5)return void t.toast("请输入电话");if(!r||!r.length)return void t.toast("请选择地区");var i=r[r.length-1];return i?!n||n.length<1?void t.toast("请输入地址"):void t.addressEditModel.save(e,o,i.id,n).then(function(e){e?(t.toast("保存成功"),t.goBack()):t.toast("请稍后再试")}):void t.toast("请选择地区")}function d(){t.isDefault=!t.isDefault}function p(){var e={};e.consignee=t.addressEditModel.consignee.id,o.consignee["delete"](e).then(function(e){e?(t.toast("删除成功"),t.goBack()):t.toast("删除失败")})}function h(){t.pickerData=[],t.pickerRegions=[],t.pickerRegionName=null,t.showPicker=!0,t.addressEditModel.reloadIfNeeded().then(function(e){e?t.pickerData=t.addressEditModel.regions:(t.toast("请稍后再试"),t.touchPickerCancel())})}function g(e){t.pickerRegions.push(e),t.pickerRegionName=m(t.pickerRegions),e.regions&&e.regions.length?t.pickerData=e.regions:(t.regions=t.pickerRegions,t.showPicker=!1)}function f(){t.showPicker=!1,t.pickerData=[],t.pickerRegions=[],t.pickerRegionName=null}function m(t){for(var e="",o=0;o<t.length;++o)e+=t[o].name,e+=" ";return e}t.touchSave=l,t.touchSetDefault=d,t.touchPickerShow=h,t.touchPickerRegion=g,t.touchPickerCancel=f,t.formatRegions=m,t.touchDelete=p,t.touchCancel=u,t.showPicker=!1,t.pickerData=[],t.pickerRegions=[],t.pickerRegionName=null,t.addressEditModel=c;var v=t.addressEditModel.consignee;v&&v.id&&(t.name=v.name,t.mobile=v.mobile,t.regions=v.regions,t.address=v.address,t.isDefault=v.is_default)}angular.module("app").controller("AddressEditController",t),t.$inject=["$scope","$http","API","$location","$q","$window","$state","$stateParams","AddressEditModel"]}(),function(){"use strict";function t(t,e){t.state("address-edit",{needAuth:!0,url:"/address-edit",title:"收货地址",templateUrl:"modules/address-edit/address-edit.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){i.getToken()&&(this.isLoading||(this.orders=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,d)))}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.orders&&this.orders.length?this.fetch(this.orders.length/d+1,d):this.fetch(1,d)))}function l(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};null!=this.status&&(o.status=this.status);var n=this;s.order.list(o).then(function(t){n.orders=n.orders?n.orders.concat(t):t,n.isEmpty=!n.orders||!n.orders.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=t&&t.length<e?!n.isEmpty:!1})}}var d=10,p={};return p.isEmpty=!1,p.isLoaded=!1,p.isLoading=!1,p.isLastPage=!1,p.status=null,p.orders=null,p.fetch=l,p.reload=c,p.loadMore=u,p}angular.module("app").factory("MyOrderModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l,d,p){function h(){t.currentTab!=t.TAB_ALL&&(t.currentTab=t.TAB_ALL,t.myOrderModel.status=null,t.myOrderModel.reload())}function g(){t.currentTab!=t.TAB_CREATED&&(t.currentTab=t.TAB_CREATED,t.myOrderModel.status=c.ORDER_STATUS.CREATED,t.myOrderModel.reload())}function f(){t.currentTab!=t.TAB_PAID&&(t.currentTab=t.TAB_PAID,t.myOrderModel.status=c.ORDER_STATUS.PAID,t.myOrderModel.reload())}function m(){t.currentTab!=t.TAB_DELIVERING&&(t.currentTab=t.TAB_DELIVERING,t.myOrderModel.status=c.ORDER_STATUS.DELIVERING,t.myOrderModel.reload())}function v(){t.currentTab!=t.TAB_DELIVERIED&&(t.currentTab=t.TAB_DELIVERIED,t.myOrderModel.status=c.ORDER_STATUS.DELIVERIED,t.myOrderModel.reload())}function S(t){i.go("order-detail",{order:t.id})}function y(t){a.order.confirm({order:t.id}).then(function(t){i.go("confirm-delivery",{order:t.id})})}function $(t){i.go("shop-home",{shop:t.shop.id})}function A(e){t.orderExpressModel.clear(),t.orderExpressModel.order=e,i.go("order-express",{order:e.id})}function E(t){i.go("order-review",{order:t.id})}function T(e){e&&(t.paymentModel.clear(),t.paymentModel.order=e,i.go("payment",{}))}function P(e){t.cancellingOrder=e,t.showDialog=!0}function L(){t.cancellingOrder=null,t.showDialog=!1}function C(){a.order.cancel({order:t.cancellingOrder.id,reason:1}).then(function(e){t.myOrderModel.reload(),t.cancellingOrder=null,t.showDialog=!1})}t.TAB_ALL=0,t.TAB_CREATED=1,t.TAB_PAID=2,t.TAB_DELIVERING=3,t.TAB_DELIVERIED=4,t.currentTab=t.TAB_ALL,t.cancellingOrder=null,t.showDialog=!1,t.myOrderModel=l,t.paymentModel=u,t.orderExpressModel=d,"all"==s.tab?(t.currentTab=t.TAB_ALL,t.myOrderModel.status=null):"created"==s.tab?(t.currentTab=t.TAB_CREATED,t.myOrderModel.status=c.ORDER_STATUS.CREATED):"paid"==s.tab?(t.currentTab=t.TAB_PAID,t.myOrderModel.status=c.ORDER_STATUS.PAID):"delivering"==s.tab?(t.currentTab=t.TAB_DELIVERING,t.myOrderModel.status=c.ORDER_STATUS.DELIVERING):"delivered"==s.tab?(t.currentTab=t.TAB_DELIVERIED,t.myOrderModel.status=c.ORDER_STATUS.DELIVERIED):(t.currentTab=t.TAB_ALL,t.myOrderModel.status=null),t.touchTabAll=h,t.touchTabCreated=g,t.touchTabPaid=f,t.touchTabDelivering=m,t.touchTabDeliveried=v,t.touchDialogCancel=L,t.touchDialogConfirm=C,t.touchOrder=S,t.touchPay=T,t.touchCancel=P,t.touchConfirm=y,t.touchExpress=A,t.touchComment=E,t.touchShop=$,t.isB2B2C=p.getPlatform().type,t.isShippingEnable=p.getFeature().logistics,t.myOrderModel.reload()}angular.module("app").controller("MyOrderController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyOrderModel","OrderExpressModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("my-order",{needAuth:!0,url:"/my-order?tab",title:"我的订单",templateUrl:"modules/my-order/my-order.html"
})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l,d){function p(){t.order&&(t.paymentModel.clear(),t.paymentModel.order=t.order,i.go("payment",{}))}function h(t){i.go("shop-home",{shop:t.shop.id})}function g(){t.order&&(t.showDialog=!0)}function f(){t.showDialog=!1}function m(){a.order.cancel({order:E,reason:1}).then(function(e){t.toast("取消成功"),t.showDialog=!1,A()})}function v(){a.order.confirm({order:E}).then(function(e){t.toast("确认成功"),A()})}function S(){t.orderExpressModel.clear(),t.orderExpressModel.order=t.order,i.go("order-express",{order:t.order.id})}function y(){i.go("order-review",{order:t.order.id})}function $(t){i.go("product",{product:t.id})}function A(){t.isLoading=!0,t.isLoaded=!1,a.order.get({order:E}).then(function(e){t.order=e;var o=e.promos;t.promos=[];for(var n in o)"score"==o[n].promo?o[n].name="积分":"cashgift"==o[n].promo?o[n].name="红包":"preferential"==o[n].promo?o[n].name="优惠金额":"goods_reduction"==o[n].promo?o[n].name="商品减免":"order_reduction"==o[n].promo?o[n].name="订单减免":"coupon_reduction"==o[n].promo&&(o[n].name="优惠券减免");t.promos=o,t.isLoading=!1,t.isLoaded=!0})}t.isShippingEnable=d.getFeature().logistics;var E=s.order;t.order={id:E},t.isLoading=!1,t.isLoaded=!1,t.touchPay=p,t.touchCancel=g,t.touchConfirm=v,t.touchExpress=S,t.touchComment=y,t.touchProduct=$,t.touchShop=h,t.showDialog=!1,t.touchDialogCancel=f,t.touchDialogConfirm=m,t.paymentModel=u,t.orderExpressModel=l,A()}angular.module("app").controller("OrderDetailController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","OrderExpressModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("order-detail",{needAuth:!0,url:"/order-detail/?order",title:"订单详情",templateUrl:"modules/order-detail/order-detail.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(){t.isLoading=!0,t.isLoaded=!1,a.order.get({order:f}).then(function(e){t.order=e,t.isLoading=!1,t.isLoaded=!0})}function l(t){t.review||(t.review={}),t.review.goods=t.id,t.review.grade=c.ORDER_GRADE.GOOD,t.review.content||(t.review.content="")}function d(t){t.review||(t.review={}),t.review.goods=t.id,t.review.grade=c.ORDER_GRADE.MEDIUM,t.review.content||(t.review.content="")}function p(t){t.review||(t.review={}),t.review.goods=t.id,t.review.grade=c.ORDER_GRADE.BAD,t.review.content||(t.review.content="")}function h(){t.isAnonymous=!t.isAnonymous}function g(){for(var e=[],o=0;o<t.order.goods.length;o++){var n=t.order.goods[o];if(n.review){if(!n.review.grade)return void t.toast("请选择评价");e.push(n.review)}}if(e.length<t.order.goods.length)return void t.toast("请评价全部商品");var r={};r.order=f,r.review=JSON.stringify(e),t.isAnonymous?r.is_anonymous=1:r.is_anonymous=0,a.order.review(r).then(function(e){e&&i.go("review-success",{order:t.order.id})})}var f=s.order;t.order={id:f},t.isLoading=!1,t.isLoaded=!1,t.isAnonymous=0,t.touchGood=l,t.touchMedium=d,t.touchBad=p,t.touchSetAnonymous=h,t.touchSubmit=g,u()}angular.module("app").controller("OrderReviewController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("order-review",{needAuth:!0,url:"/order-review?order",title:"订单评价",templateUrl:"modules/order-review/order-review.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){this.order=null,this.info=null}function u(){var t=this;return s.shipping.statusGet({order_id:this.order.id,tracking_no:null}).then(function(e){return t.info=e,t.status=e.status,!!e})}var l={};return l.order=null,l.info=null,l.status=null,l.clear=c,l.reload=u,l}angular.module("app").factory("OrderExpressModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){t.orderExpressModel=u,t.orderExpressModel.reload()}angular.module("app").controller("OrderExpressController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","OrderExpressModel"]}(),function(){"use strict";function t(t,e){t.state("order-express",{needAuth:!0,url:"/order-express/?order",title:"物流信息",templateUrl:"modules/order-express/order-express.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),s="snsapi_userinfo",a=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope="+s+"&referer="+i;o.location.href=a}angular.module("app").controller("WeChatAuthController",t),t.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function t(t,e){t.state("wechat-auth",{needAuth:!1,url:"/wechat-auth",title:"微信登录",controller:"WeChatAuthController",templateUrl:"modules/wechat-auth/wechat-auth.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l){var d=s.order;if(!d)return void r.go("payment-failed",{order:d,reason:"参数错误"});o.$on("onPaySuccess",function(t,e){r.go("payment-success",{order:d})}),o.$on("onPayFailed",function(t,e){r.go("payment-failed",{order:d,reason:"微信支付失败"})});var p=l.getConfig(),h=p["wxpay.web"];return h?(wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:h.app_id,timestamp:h.timestamp,nonceStr:h.nonceStr,signature:h.signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){a.pay(d).then(function(t){})}),void wx.error(function(t){GLOBAL_CONFIG.DEBUG&&o.toast(JSON.stringify(t))})):void r.go("payment-failed",{order:d,reason:"配置错误"})}angular.module("app").controller("WeChatPayController",t),t.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","WeixinService","API","ENUM","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("wechat-pay",{needAuth:!0,url:"/wechat-pay?order",title:"微信支付",controller:"WeChatPayController",templateUrl:"modules/wechat-pay/wechat-pay.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),s="snsapi_base",a=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope="+s+"&referer="+i;o.location.href=a}angular.module("app").controller("WeChatAuthBaseController",t),t.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function t(t,e){t.state("wechat-authbase",{needAuth:!1,url:"/wechat-authbase",title:"微信登录",controller:"WeChatAuthBaseController",templateUrl:"modules/wechat-authbase/wechat-authbase.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l){t.paymentModel=a;var d=s.order;if(!d)return void r.go("payment-failed",{order:d,reason:"参数错误"});o.$on("onPaySuccess",function(t,e){r.go("payment-success",{order:d})}),o.$on("onPayFailed",function(t,e){r.go("payment-failed",{order:d,reason:"支付宝支付失败"})});var p=encodeURIComponent(n.location.protocol+"//"+n.location.host+n.location.pathname),h={order:d,code:"alipay.wap",referer:p};c.payment.pay(h).then(function(e){return e.data.alipay&&e.data.alipay.html&&(t.alipay_html=u.trustAsHtml(e.data.alipay.html)),!0})}angular.module("app").controller("AliPayWapController",t),t.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","PaymentModel","API","$sce","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("alipay-wap",{needAuth:!0,url:"/alipay-wap?order",title:"微信支付",controller:"AliPayWapController",templateUrl:"modules/alipay-wap/alipay-wap.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){if(i.getToken()&&!this.isLoading){this.consignees=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1;var t=this;s.consignee.list({}).then(function(e){t.consignees=e,t.isEmpty=!t.consignees||!t.consignees.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=!0})}}var u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.consignees=null,u.reload=c,u}angular.module("app").factory("MyAddressModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){t.addressEditModel.clear(),t.addressEditModel.consignee=null,i.go("address-edit",{})}function d(e){t.addressEditModel.clear(),t.addressEditModel.consignee=e,i.go("address-edit",{})}t.touchCreate=l,t.touchModify=d,t.myAddressModel=u,t.addressEditModel=c,t.myAddressModel.reload()}angular.module("app").controller("MyAddressController",t),t.$inject=["$scope","$http","$rootScope","$stateParams","$location","$state","API","ENUM","AddressEditModel","MyAddressModel"]}(),function(){"use strict";function t(t,e){t.state("my-address",{needAuth:!0,url:"/my-address",title:"地址管理",templateUrl:"modules/my-address/my-address.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(t){if(i.getToken()){var e=this;s.product.unlike({product:t}).then(function(t){e.reloadProduct()})}}function u(t){if(i.getToken()){var e=this;s.shop.shopUnLike({shop:t}).then(function(t){e.reloadShop()})}}function l(){i.getToken()&&(this.isProductLoading||(this.products=null,this.isProductEmpty=!1,this.isProductLoaded=!1,this.isProductLastPage=!1,this.fetchProduct(1,m)))}function d(){i.getToken()&&(this.isShopLoading||(this.shops=null,this.isShopEmpty=!1,this.isShopLoaded=!1,this.isShopLastPage=!1,this.fetchShop(1,m)))}function p(){this.isProductLoading||this.isProductLastPage||(this.products&&this.products.length?this.fetchProduct(this.products.length/m+1,m):this.fetchProduct(1,m))}function h(){this.isShopLoading||this.isShopLastPage||(this.shops&&this.shops.length?this.fetchShop(this.shops.length/m+1,m):this.fetchShop(1,m))}function g(t,e){this.isProductLoading=!0;var o=this;s.product.likedList({page:t,per_page:e}).then(function(t){o.products=o.products?o.products.concat(t):t,o.isProductEmpty=!o.products||!o.products.length,o.isProductLoaded=!0,o.isProductLoading=!1,o.isProductLastPage=t&&t.length<e?!o.isProductEmpty:!1})}function f(t,e){this.isLoading=!0;var o=this;s.shop.shopFavoriteList({page:t,per_page:e}).then(function(t){o.shops=o.shops?o.shops.concat(t):t,o.isShopEmpty=!o.shops||!o.shops.length,o.isShopLoaded=!0,o.isShopLoading=!1,o.isShopLastPage=t&&t.length<e?!o.isShopEmpty:!1})}var m=10,v={};return v.isProductEmpty=!1,v.isProductLoaded=!1,v.isProductLoading=!1,v.isProductLastPage=!1,v.products=null,v.isShopEmpty=!1,v.isShopLoaded=!1,v.isShopLoading=!1,v.isShopLastPage=!1,v.shops=null,v.fetchProduct=g,v.reloadProduct=l,v.loadMoreProduct=p,v.deleteProduct=c,v.fetchShop=f,v.reloadShop=d,v.loadMoreShop=h,v.deleteShop=u,v}angular.module("app").factory("MyFavoriteModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i){function s(t){e.go("product",{product:t.id})}function a(t){e.go("shop-home",{shop:t.id})}function c(e){t.myFavoriteModel.deleteProduct(e.id)}function u(e){t.myFavoriteModel.deleteShop(e.id)}function l(){t.showShopList=!1,t.showProductList=!0,t.myFavoriteModel.reloadProduct()}function d(){t.showShopList=!0,t.showProductList=!1,t.myFavoriteModel.reloadShop()}t.myFavoriteModel=r,t.isB2B2C=i.getPlatform().type,t.showShopList=!1,t.showProductList=!0,t.touchProduct=s,t.touchProductDelete=c,t.touchShopType=d,t.touchProductType=l,t.touchShop=a,t.touchShopDelete=u,t.myFavoriteModel.reloadProduct()}angular.module("app").controller("MyFavoriteController",t),t.$inject=["$scope","$state","API","ENUM","MyFavoriteModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("my-favorite",{needAuth:!0,url:"/my-favorite",title:"我的收藏",templateUrl:"modules/my-favorite/my-favorite.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){i.getToken()&&(this.isLoading||(this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,d)))}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/d+1,d):this.fetch(1,d)))}function l(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};o.status=this.status;var n=this;s.cashgift.list(o).then(function(t){n.cashgifts=n.cashgifts?n.cashgifts.concat(t):t,n.isEmpty=!n.cashgifts||!n.cashgifts.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=t&&t.length<e?!n.isEmpty:!1})}}var d=10,p={};return p.isEmpty=!1,p.isLoaded=!1,p.isLoading=!1,p.isLastPage=!1,p.status=null,p.cashgifts=null,p.fetch=l,p.reload=c,p.loadMore=u,p}angular.module("app").factory("MyCashgiftModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s){function a(){t.currentTab!=t.TAB_AVAILABLE&&(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=s.CASHGIFT_STATUS.AVAILABLE,t.myCashgiftModel.reload())}function c(){t.currentTab!=t.TAB_EXPIRED&&(t.currentTab=t.TAB_EXPIRED,t.myCashgiftModel.status=s.CASHGIFT_STATUS.EXPIRED,t.myCashgiftModel.reload())}function u(){t.currentTab!=t.TAB_USED&&(t.currentTab=t.TAB_USED,t.myCashgiftModel.status=s.CASHGIFT_STATUS.USED,t.myCashgiftModel.reload())}t.TAB_AVAILABLE=0,t.TAB_EXPIRED=1,t.TAB_USED=2,t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel=i,"available"==n.tab?(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=s.CASHGIFT_STATUS.AVAILABLE):"expired"==n.tab?(t.currentTab=t.TAB_EXPIRED,t.myCashgiftModel.status=s.CASHGIFT_STATUS.EXPIRED):"used"==n.tab?(t.currentTab=t.TAB_USED,t.myCashgiftModel.status=s.CASHGIFT_STATUS.USED):(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=s.CASHGIFT_STATUS.AVAILABLE),t.touchTabAvailable=a,t.touchTabExpired=c,t.touchTabUsed=u,t.myCashgiftModel.reload()}angular.module("app").controller("MyCashgiftController",t),t.$inject=["$scope","$http","$location","$stateParams","$state","MyCashgiftModel","ENUM"]}(),function(){"use strict";function t(t,e){t.state("my-cashgift",{needAuth:!0,url:"/my-cashgift",title:"我的红包",templateUrl:"modules/my-cashgift/my-cashgift.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){if(i.getToken()){var t=this;s.score.get({}).then(function(e){t.score=e.score,t.rule=e.rule})}}function u(){i.getToken()&&(this.isLoading||(this.history=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,p)))}function l(){i.getToken()&&(this.isLoading||this.isLastPage||(this.history&&this.history.length?this.fetch(this.history.length/p+1,p):this.fetch(1,p)))}function d(t,e){this.isLoading=!0;var o=this,n={page:t,per_page:e};this.status&&(n.status=this.status),s.score.historyList(n).then(function(t){o.history=o.history?o.history.concat(t):t,o.isEmpty=!o.history||!o.history.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=t&&t.length<e?!o.isEmpty:!1})}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.score=null,h.rule=null,h.history=null,h.count=c,h.fetch=d,h.reload=u,h.loadMore=l,h}angular.module("app").factory("MyScoreModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l){function d(){t.currentTab!=t.TAB_ALL&&(t.currentTab=t.TAB_ALL,t.myScoreModel.status=null,t.myScoreModel.reload())}function p(){t.currentTab!=t.TAB_INCOME&&(t.currentTab=t.TAB_INCOME,t.myScoreModel.status=c.SCORE_STATUS.INCOME,t.myScoreModel.reload())}function h(){t.currentTab!=t.TAB_EXPENDITURE&&(t.currentTab=t.TAB_EXPENDITURE,t.myScoreModel.status=c.SCORE_STATUS.EXPENDITURE,t.myScoreModel.reload())}t.TAB_ALL=0,t.TAB_INCOME=1,t.TAB_EXPENDITURE=2,t.currentTab=t.TAB_ALL,t.myScoreModel=l,t.paymentModel=u,"all"==s.tab?(t.currentTab=t.TAB_ALL,t.myScoreModel.status=null):"income"==s.tab?(t.currentTab=t.TAB_INCOME,t.myScoreModel.status=c.SCORE_STATUS.INCOME):"expenditure"==s.tab?(t.currentTab=t.TAB_EXPENDITURE,t.myScoreModel.status=c.SCORE_STATUS.EXPENDITURE):(t.currentTab=t.TAB_ALL,t.myScoreModel.status=null),t.touchTabAll=d,t.touchTabIncome=p,t.touchTabExpenditure=h,t.myScoreModel.count(),t.myScoreModel.reload()}angular.module("app").controller("MyScoreController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyScoreModel"]}(),function(){"use strict";function t(t,e){t.state("my-score",{needAuth:!0,url:"/my-score?tab",title:"我的积分",templateUrl:"modules/my-score/my-score.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){function i(){if(!t.loading){var e={};l=1,e=c?{page:l,per_page:u,id:c}:{page:l,per_page:u,id:0},n.article.list(e).then(function(e){e&&(t.articles=e.articles,t.loading=!1,t.loaded=!0,t.more=parseInt(e.paged.more))})}}function s(){if(!t.loading){var e={};e=c?{page:l,per_page:u,id:c}:{page:l,per_page:u,id:0},n.article.list(e).then(function(e){e&&(t.articles=t.articles.concat(e.articles),t.loading=!1,t.loaded=!0,t.more=parseInt(e.paged.more))})}}function a(t){t.url?r.location.href=t.url:e.go("article",{id:t.id,title:t.title})}t.touchArticle=a,t.articles=[];var c=o.id;o.title?t.title=o.title:t.title="使用帮助",t.loading=!1,t.loaded=!1,t.more=!0;var u=10,l=1;t.reload=i,t.loadMore=s,i()}angular.module("app").controller("ArticleController",t),t.$inject=["$scope","$state","$stateParams","API","$window"]}(),function(){"use strict";function t(t,e){t.state("article",{needAuth:!1,url:"/article?id&title",title:"使用帮助",templateUrl:"modules/article/article.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){r.order;t.reason=r.reason,t.touchToHome=function(){n.go("home",{})}}angular.module("app").controller("ReviewSuccessController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("review-success",{needAuth:!0,url:"/review-success?order",title:"评价成功",templateUrl:"modules/review-success/review-success.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=r.order;t.isDelivery=!0,t.reason=r.reason,t.touchDetail=function(){n.go("order-detail",{order:i})},t.touchComment=function(){n.go("order-review",{order:i})}}angular.module("app").controller("ConfirmDeliveryController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function t(t,e){t.state("confirm-delivery",{needAuth:!0,url:"/confirm-delivery?order",title:"交易成功",templateUrl:"modules/confirm-delivery/confirm-delivery.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s){function a(){var e=t.oldPassword,o=t.newPassword,n=t.newPassword2;return o!=n?void t.toast("两次密码输入不一致"):void i.user.passwordUpdate({old_password:e,password:o}).then(function(e){0==e.data.error_code?(t.toast("密码修改成功"),t.goBack()):t.toast(e.data.error_desc)})}t.oldPassword="",t.newPassword="",t.touchChangePassword=a}angular.module("app").controller("ChangePasswordController",t),t.$inject=["$scope","$http","$window","$location","$state","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("change-password",{needAuth:!0,url:"/change-password",title:"修改密码",templateUrl:"modules/change-password/change-password.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l,d){function p(e){return t.selectedType?e.channel==t.selectedType.channel:!1}function h(e){t.selectedType=e}function g(){if(!t.selectedType)return void t.toast("请选择支持方式");switch(t.selectedType.channel){case"chinapay":var e=encodeURIComponent(l.location.protocol+"//"+l.location.host+l.location.pathname),o={order:t.paymentModel.order.id,shop:t.paymentModel.order.shop.id,code:"teegon.wap",channel:"chinapay",referer:e};a.payment.pay(o).then(function(t){return t.data.teegon&&t.data.teegon.url&&(l.location.href=t.data.teegon.url),!0});break;case"wxpay":var e=encodeURIComponent(l.location.protocol+"//"+l.location.host+l.location.pathname),o={order:t.paymentModel.order.id,shop:t.paymentModel.order.shop.id,code:"teegon.wap",channel:"wxpay_jsapi",referer:e};a.payment.pay(o).then(function(t){return t.data.teegon&&t.data.teegon.url&&(l.location.href=t.data.teegon.url),!0})}}function f(){if(!d.FOR_WEIXIN)return!1;var t=navigator.userAgent.toLowerCase()||navigator.vendor.toLowerCase();return"micromessenger"==t.match(/MicroMessenger/i)}function m(){var e={name:"微信支付",desc:"天工收银微信支付",channel:"wxpay"};f()&&t.teegonTypes.push(e),t.paymentModel.reload(u.order).then(function(t){})}return u.order?(t.selectedType=null,t.paymentModel=u,t.isSelected=p,t.touchSelect=h,t.touchSubmit=g,t.teegonTypes=[],void m()):void i(function(){r.goHome()},1)}angular.module("app").controller("TeegonController",t),t.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel","$window","CONSTANTS"]}(),function(){"use strict";function t(t,e){t.state("teegon",{needAuth:!1,url:"/teegon",title:"收银台",templateUrl:"modules/teegon/teegon.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),s=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=3&referer="+i;o.location.href=s}angular.module("app").controller("QQAuthController",t),t.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function t(t,e){t.state("qq-auth",{needAuth:!1,url:"/qq-auth",title:"QQ登录",controller:"QQAuthController",templateUrl:"modules/qq-auth/qq-auth.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l){function d(e){t.cancellingOrder=e,t.showDialog=!0}function p(){t.cancellingOrder=null,t.showDialog=!1}function h(){a.order.cancel({order:t.cancellingOrder.id,reason:1}).then(function(e){t.myOrderModel.reload(),t.cancellingOrder=null,t.showDialog=!1})}function g(t){return t==c.BONUS_STATUS.WAIT?"审核中":t==c.BONUS_STATUS.FINISH?"已分成":t==c.BONUS_STATUS.CANCEL?"已取消":t==c.BONUS_STATUS.REVOKE?"已撤销":""}function f(t){return t==c.BONUS_TYPE.SIGNUP?"注册分成":"订单分成"}function m(){i.go("my-recommend",{})}function v(){i.go("my-balance",{})}function S(){i.go("bonus-rule",{})}t.cancellingOrder=null,t.showDialog=!1,t.bonus_amount=0,t.total_bonus=0,t.myBonusModel=u,t.touchDialogCancel=p,t.touchDialogConfirm=h,t.touchRecommend=m,t.touchMyBalance=v,t.touchRules=S,t.touchCancel=d,t.getBonusStatus=g,t.getBonusType=f,t.myBonusModel.reload()}angular.module("app").controller("BonusController",t),t.$inject=["$scope","$rootScope","$window","$timeout","$location","$state","$stateParams","API","ENUM","BonusModel","ConfigModel"]}(),function(){"use strict";function t(t,e){t.state("bonus",{needAuth:!0,url:"/bonus",title:"我的订单",templateUrl:"modules/bonus/bonus.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){return i.getToken()&&!this.isLoading?(this.bonuses=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,p),this.getInfo()):void 0}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.bonuses&&this.bonuses.length?this.fetch(this.bonuses.length/p+1,p):this.fetch(1,p)))}function l(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};null!=this.status&&(o.status=this.status);var n=this;s.bonus.list(o).then(function(t){return n.bonuses=n.bonuses?n.bonuses.concat(t):t,n.isEmpty=!n.bonuses||!n.bonuses.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=t&&t.length<e?!n.isEmpty:!1,!0})}}function d(){if(i.getToken()){var t={},e=this;s.bonus.get(t).then(function(t){return e.bonus_info=t,!0})}}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.fetch=l,h.getInfo=d,h.reload=c,h.loadMore=u,h.bonuses=[],h}angular.module("app").factory("BonusModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){r.go("balance-history",{})}function u(){r.go("withdraw-history",{})}function l(){t.showDialog=!0}function d(){t.input.withdraw=parseFloat(t.balanceModel.balanceAmount)}function p(){t.showDialog=!1,t.input.memo="",t.input.withdraw=""}function h(){var e=parseFloat(t.input.withdraw);if(isNaN(e))return void t.toast("请输入数字");if(0>=e)return void t.toast("金额不能小于零");if(e>parseFloat(t.balanceModel.balanceAmount))return void t.toast("金额超出提现范围");if(0==t.input.memo.length)return void t.toast("Memo不能为空");var o={};o.cash=e,o.memo=t.input.memo,s.withdraw.submit(o).then(function(e){t.balanceModel.reload(),t.cancellingOrder=null,t.showDialog=!1,r.go("withdraw-success",{withdraw:e.cash,member_memo:e.member_memo})})}t.touchBalanceDetail=c,t.touchWithDrawHistory=u,t.touchWithDraw=l,t.touchDialogCancel=p,t.touchDialogConfirm=h,t.touchWithDrawAll=d,t.balanceModel=a,t.input={withdraw:"",memo:""},t.balanceModel.reload()}angular.module("app").controller("MyBalanceController",t),t.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","BalanceModel"]}(),function(){"use strict";function t(t,e){t.state("my-balance",{needAuth:!0,url:"/my-balance",title:"可用资金",templateUrl:"modules/my-balance/my-balance.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){i.getToken()&&(this.isLoading||(this.balances=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,p),this.get()))}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.balances&&this.balances.length?this.fetch(this.balances.length/p+1,p):this.fetch(1,p)))}function l(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};null!=this.status&&(o.status=this.status);var n=this;s.balance.list(o).then(function(t){n.balances=n.balances?n.balances.concat(t):t,n.isEmpty=!n.balances||!n.balances.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=t&&t.length<e?!n.isEmpty:!1})}}function d(){if(i.getToken()){var t={},e=this;s.balance.get(t).then(function(t){e.balanceAmount=t})}}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.fetch=l,h.reload=c,h.get=d,h.loadMore=u,h.balances=[],h.balanceAmount=0,h}angular.module("app").factory("BalanceModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){t.currentTab!=t.TAB_ALL&&(t.currentTab=t.TAB_ALL,t.myBalanceModel.status=null,t.myBalanceModel.reload())}function d(){t.currentTab!=t.TAB_INCOME&&(t.currentTab=t.TAB_INCOME,t.myBalanceModel.status=c.BALANCE_STATUS.IN,t.myBalanceModel.reload())}function p(){t.currentTab!=t.TAB_EXPENDITURE&&(t.currentTab=t.TAB_EXPENDITURE,t.myBalanceModel.status=c.BALANCE_STATUS.OUT,t.myBalanceModel.reload())}t.TAB_ALL=0,t.TAB_INCOME=1,t.TAB_EXPENDITURE=2,t.currentTab=t.TAB_ALL,t.myBalanceModel=u,"all"==s.tab?(t.currentTab=t.TAB_ALL,t.myBalanceModel.status=null):"income"==s.tab?(t.currentTab=t.TAB_INCOME,t.myBalanceModel.status=c.BALANCE_STATUS.IN):"expenditure"==s.tab?(t.currentTab=t.TAB_EXPENDITURE,t.myBalanceModel.status=c.BALANCE_STATUS.OUT):(t.currentTab=t.TAB_ALL,t.myBalanceModel.status=null),t.touchTabAll=l,t.touchTabIncome=d,t.touchTabExpenditure=p,t.myBalanceModel.reload()}angular.module("app").controller("BalanceHistoryController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","BalanceModel"]}(),function(){"use strict";function t(t,e){t.state("balance-history",{needAuth:!0,url:"/balance-history",title:"资金明细",templateUrl:"modules/balance-history/balance-history.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(e){t.cancellingWithDraw=e,t.showDialog=!0}function d(){t.cancellingWithDraw=null,t.showDialog=!1}function p(){a.withdraw.cancel({id:t.cancellingWithDraw.id}).then(function(e){t.withDrawHistoryModel.reload(),t.cancellingWithDraw=null,t.showDialog=!1})}t.cancellingWithDraw=null,t.showDialog=!1,t.withDrawHistoryModel=u,t.touchDialogCancel=d,t.touchDialogConfirm=p,t.touchCancel=l,t.withDrawHistoryModel.reload()}angular.module("app").controller("WithDrawHistoryController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","WithDrawHistoryModel"]}(),function(){"use strict";function t(t,e){t.state("withdraw-history",{needAuth:!0,url:"/withdraw-history",title:"提现记录",templateUrl:"modules/withdraw-history/withdraw-history.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){i.getToken()&&(this.isLoading||(this.withdraws=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,d)))}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.withdraws&&this.withdraws.length?this.fetch(this.withdraws.length/d+1,d):this.fetch(1,d)))}function l(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};null!=this.status&&(o.status=this.status);var n=this;s.withdraw.list(o).then(function(t){n.withdraws=n.withdraws?n.withdraws.concat(t):t,n.isEmpty=!n.withdraws||!n.withdraws.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=t&&t.length<e?!n.isEmpty:!1})}}var d=10,p={};return p.isEmpty=!1,p.isLoaded=!1,p.isLoading=!1,p.isLastPage=!1,p.status=null,p.withdraws=[],p.fetch=l,p.reload=c,p.loadMore=u,p}angular.module("app").factory("WithDrawHistoryModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){t.myRecommendModel=a,t.myRecommendModel.reload()}angular.module("app").controller("MyRecommendController",t),t.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","MyRecommendModel"]}(),function(){"use strict";function t(t,e){t.state("my-recommend",{needAuth:!0,url:"/my-recommend",title:"可用资金",templateUrl:"modules/my-recommend/my-recommend.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(){i.getToken()&&this.fetch()}function u(){if(i.getToken()){var t=this,e={};s.recommend.bonusInfo(e).then(function(e){t.bonus_info=e})}}var l={};return l.reload=c,l.fetch=u,l}angular.module("app").factory("MyRecommendModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r){t.withdraw=r.withdraw,t.member_memo=r.member_memo}angular.module("app").controller("WithDrawSuccessController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"];
}(),function(){"use strict";function t(t,e){t.state("withdraw-success",{needAuth:!0,url:"/withdraw-success?withdraw&member_memo",title:"提现成功",templateUrl:"modules/withdraw-success/withdraw-success.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){t.bonusModel=a,t.bonusModel.bonus_info&&(t.rule_desc=u.trustAsHtml(t.bonusModel.bonus_info.rule_desc)),c.bonus.get().then(function(e){t.rule_desc=u.trustAsHtml(e.rule_desc)})}angular.module("app").controller("BonusRuleController",t),t.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","BonusModel","API","$sce"]}(),function(){"use strict";function t(t,e){t.state("bonus-rule",{needAuth:!1,url:"/bonus-rule",title:"分成规则",controller:"BonusRuleController",templateUrl:"modules/bonus-rule/bonus-rule.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(){a.shop.shopInfo({shop:t.shopId}).then(function(e){t.shop=e})}function l(){u()}t.reload=l,t.shopId=s.shopId,l()}angular.module("app").controller("ShopDetailsController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("shop-details",{needAuth:!1,url:"/shop-details?shopId",title:"店铺详情",templateUrl:"modules/shop-details/shop-details.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l){function d(){c.shop.shopInfo({shop:t.shopId}).then(function(e){t.shop=e})}function p(){s.go("shop-list",{sortKey:u.SORT_KEY.DATE,sortValue:u.SORT_VALUE.DESC,shop:t.shopId,navTitle:"最新商品",navStype:"newProduct"})}function h(){s.go("shop-list",{sortKey:u.SORT_KEY.DEFAULT,sortValue:u.SORT_VALUE.DEFAULT,shop:t.shopId,navTitle:"全部商品",navStype:"allProduct"})}function g(){s.go("shop-list",{sortKey:u.SORT_KEY.SALE,sortValue:u.SORT_VALUE.DESC,shop:t.shopId,navTitle:"热销商品",navStype:"hotProduct"})}function f(){s.go("shop-list",{sortKey:u.SORT_KEY.DEFAULT,sortValue:u.SORT_VALUE.DEFAULT,shop:t.shopId,navTitle:"推荐商品",navStype:"recommendProduct"})}function m(){s.go("shop-details",{shopId:t.shopId})}function v(){return!t.currentKeyword||t.currentKeyword.length<1?void t.toast("请输入正确的关键字"):(r.$emit("searchChanged",t.currentKeyword),void s.go("shop-list",{sortKey:u.SORT_KEY.DEFAULT,sortValue:u.SORT_VALUE.DEFAULT,shop:t.shopId,keyword:t.currentKeyword,category:null,navTitle:t.currentKeyword,showSearch:!0,navStype:"allProduct"}))}function S(){s.go("shop-category",{shop:t.shopId})}function y(t){s.go("product",{product:t.id})}function $(){t.showTel=!1}function A(){window.location.href="tel:"+t.shop.tel,t.showTel=!1}function E(){t.showTel=!0}function T(){c.recommend.productList({shop:t.shopId,page:1,per_page:4}).then(function(e){t.recommendProducts=e})}function P(){return l.getToken()?void(t.shop.is_watching?(t.shop.is_watching=!1,c.shop.shopUnLike({shop:t.shopId}).then(function(e){t.shop.is_watching=e,t.toast("取消收藏")},function(e){t.shop.is_watching=!0})):(t.shop.is_watching=!0,c.shop.shopLike({shop:t.shopId}).then(function(e){t.shop.is_watching=e,t.toast("收藏成功")},function(e){t.shop.is_watching=!1}))):void t.goSignin()}function L(){var e={};e.shop=t.shopId,e.sort_key=u.SORT_KEY.DATE,e.sort_value=u.SORT_VALUE.DESC,e.page=1,e.per_page=4,c.product.list(e).then(function(e){t.newProducts=e})}function C(){d(),T(),L()}t.reload=C,t.shopId=a.shop,t.showTel=!1,t.touchShopNewProduct=p,t.touchShopAllProduct=h,t.touchShopHotProduct=g,t.touchRecommendProduct=f,t.touchProduct=y,t.touchLike=P,t.touchCallTel=E,t.touchTelCanel=$,t.touchTelSure=A,t.touchSearch=v,t.touchShopCategory=S,t.touchDetails=m,C()}angular.module("app").controller("ShopHomeController",t),t.$inject=["$scope","$http","$window","$timeout","$rootScope","$location","$state","$stateParams","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function t(t,e){t.state("shop-home",{needAuth:!1,url:"/shop-home?shop",title:"店铺首页",templateUrl:"modules/shop-home/shop-home.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(){t.isLoading||(t.products=null,t.isEmpty=!1,t.isLoaded=!1,"allProduct"==t.navStype?t.isShowFilter=!0:t.isShowFilter=!1,v(1,S))}function l(){t.isLoading||t.isLastPage||(t.products&&t.products.length?v(t.products.length/S+1,S):v(1,S))}function d(){var e=c.SORT_KEY.DEFAULT,o=c.SORT_VALUE.DEFAULT;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,u())}function p(){var e=c.SORT_KEY.SALE,o=c.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,u())}function h(){var e=c.SORT_KEY.DATE,o=c.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,u())}function g(){var e=c.SORT_KEY.PRICE,o=c.SORT_VALUE.DESC;t.currentSortKey==c.SORT_KEY.PRICE?t.currentSortValue==c.SORT_VALUE.DEFAULT||t.currentSortValue==c.SORT_VALUE.ASC?(e=c.SORT_KEY.PRICE,o=c.SORT_VALUE.DESC):(e=c.SORT_KEY.PRICE,o=c.SORT_VALUE.ASC):(e=c.SORT_KEY.PRICE,o=c.SORT_VALUE.DESC),e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,u())}function f(){var e=c.SORT_KEY.CREDIT,o=c.SORT_VALUE.DESC;e==t.currentSortKey&&o==t.currentSortValue||(t.currentSortKey=e,t.currentSortValue=o,u())}function m(t){i.go("product",{product:t.id})}function v(e,o){t.isLoading=!0;var n={};t.currentCategory&&(n.category=t.currentCategory),t.currentKeyword&&(n.keyword=t.currentKeyword),n.sort_key=t.currentSortKey,n.sort_value=t.currentSortValue,n.page=e,n.per_page=o,n.shop=t.shop,"recommendProduct"==t.navStype?a.recommend.productList(n).then(function(e){t.products=t.products?t.products.concat(e):e,t.isEmpty=!t.products||!t.products.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=e&&e.length<o?!t.isEmpty:!1}):a.product.list(n).then(function(e){t.products=t.products?t.products.concat(e):e,t.isEmpty=!t.products||!t.products.length,t.isLoaded=!0,t.isLoading=!1,t.isLastPage=e&&e.length<o?!t.isEmpty:!1})}var S=10;t.currentSortKey=s.sortKey?s.sortKey:c.SORT_KEY.DEFAULT,t.currentSortValue=s.sortValue?s.sortValue:c.SORT_KEY.DESC,t.currentKeyword=s.keyword?s.keyword:null,t.currentCategory=s.category,t.shop=s.shop,t.navTitle=s.navTitle,t.navStype=s.navStype,t.showSearch=s.showSearch,t.touchSortDefault=d,t.touchSortSale=p,t.touchSortDate=h,t.touchSortPrice=g,t.touchSortCredit=f,t.touchProduct=m,t.loadMore=l,t.isEmpty=!1,t.isLoaded=!1,t.isLoading=!1,t.isLastPage=!1,t.isShowFilter=!1,u()}angular.module("app").controller("ShopListController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("shop-list",{needAuth:!1,url:"/shop-list?sortKey&sortValue&keyword&shop&navTitle&navStype&category&showSearch",title:"商品列表",templateUrl:"modules/shop-list/shop-list.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(e){t.selectedSide=e,t.subCategories=e.categories}function d(e){if(e)i.go("shop-list",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,shop:t.shopId,keyword:null,category:e.id,navTitle:e.name,showSearch:!0,navStype:"allProduct"});else{var o=t.selectedSide;i.go("shop-list",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,shop:t.shopId,keyword:null,category:o.id,navTitle:o.name,showSearch:!0,navStype:"allProduct"})}}function p(){a.category.list({page:1,per_page:g,shop:t.shopId}).then(function(e){e&&e.length?(t.categories=e,t.selectedSide=e[0],t.subCategories=e[0].categories):(t.categories=null,t.selectedSide=null,t.subCategories=null)})}function h(){p()}t.shopId=s.shop;var g=1e3;t.categories=[],t.selectedSide=null,t.touchSide=l,t.touchMain=d,t.cartModel=u,h()}angular.module("app").controller("ShopCategoryController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","CartModel"]}(),function(){"use strict";function t(t,e){t.state("shop-category",{needAuth:!1,url:"/shop-category?shop",title:"商品分类",templateUrl:"modules/shop-category/shop-category.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(){a.recommend.brandList({page:1,per_page:100}).then(function(e){t.recommendBrands=e})}function l(t){i.go("search-result",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,keyword:null,brand:t.id,navStyle:"default"})}t.reloadRecommendBrandList=u,t.touchBrand=l,u()}angular.module("app").controller("RecommendedBrandsController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("recommended-brands",{needAuth:!1,url:"/recommended-brands",title:"推荐品牌",templateUrl:"modules/recommended-brands/recommended-brands.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(){a.recommend.shopList({page:1,per_page:100}).then(function(e){t.recommendShops=e})}function l(t){i.go("shop-details",{shopId:t.id})}t.reloadRecommendShopList=u,t.touchShop=l,u()}angular.module("app").controller("RecommendedShopsController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("recommended-shops",{needAuth:!1,url:"/recommended-shops",title:"推荐店铺",templateUrl:"modules/recommended-shops/recommended-shops.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){}angular.module("app").controller("StoreResultController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("store-result",{needAuth:!1,url:"/store-result",title:"店铺搜索结果",templateUrl:"modules/store-result/store-result.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u){function l(){t.currentTab!=t.AVAILABLE&&(t.currentTab=t.AVAILABLE,t.myCouponModel.status=u.COUPON_STATUS.AVAILABLE,t.myCouponModel.reload())}function d(){t.currentTab!=t.EXPIRED&&(t.currentTab=t.EXPIRED,t.myCouponModel.status=u.COUPON_STATUS.EXPIRED,t.myCouponModel.reload())}function p(){t.currentTab!=t.USED&&(t.currentTab=t.USED,t.myCouponModel.status=u.CASHGIFT_STATUS.USED,t.myCouponModel.reload())}t.AVAILABLE=0,t.EXPIRED=1,t.USED=2,t.currentTab=t.AVAILABLE,t.myCouponModel=s,"available"==a.tab?(t.currentTab=t.AVAILABLE,t.myCouponModel.status=u.COUPON_STATUS.AVAILABLE):"expired"==a.tab?(t.currentTab=t.EXPIRED,t.myCouponModel.status=u.COUPON_STATUS.EXPIRED):"used"==a.tab?(t.currentTab=t.USED,t.myCouponModel.status=u.COUPON_STATUS.USED):(t.currentTab=t.AVAILABLE,t.myCouponModel.status=u.COUPON_STATUS.AVAILABLE),t.touchTabAvailable=l,t.touchTabExpired=d,t.touchTabUsed=p,t.myCouponModel.reload()}angular.module("app").controller("MyCouponController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","MyCouponModel","$stateParams","API","ENUM"]}(),function(){"use strict";function t(t,e){t.state("my-coupon",{needAuth:!1,url:"/my-coupon",title:"我的优惠券",templateUrl:"modules/my-coupon/my-coupon.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a){function c(t){var e=new Date(1e3*parseInt(t)),o=e.getFullYear()+"-",n=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",r=e.getDate()+" ",i=e.getHours()+":",s=e.getMinutes()+":",a=e.getSeconds();return o+n+r+i+s+a}function u(t){for(var e in t){var o=t[e];o.start_at=c(o.start_at),o.end_at=c(o.end_at),o.status==a.COUPON_STATUS.AVAILABLE?o.statusStrig="可使用":o.status==a.COUPON_STATUS.EXPIRED?o.statusStrig="已过期":o.status==a.COUPON_STATUS.USED&&(o.statusStrig="已使用")}}function l(){i.getToken()&&(this.isLoading||(this.coupons=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,h)))}function d(){i.getToken()&&(this.isLoading||this.isLastPage||(this.coupons&&this.coupons.length?this.fetch(this.coupons.length/h+1,h):this.fetch(1,h)))}function p(t,e){if(i.getToken()){this.isLoading=!0;var o={page:t,per_page:e};o.status=this.status;var n=this;s.coupon.list(o).then(function(t){u(t),n.coupons=n.coupons?n.coupons.concat(t):t,n.isEmpty=!n.coupons||!n.coupons.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=t&&t.length<e?!n.isEmpty:!1})}}var h=10,g={};return g.isEmpty=!1,g.isLoaded=!1,g.isLoading=!1,g.isLastPage=!1,g.status=null,g.coupons=null,g.fetch=p,g.reload=l,g.loadMore=d,g}angular.module("app").factory("MyCouponModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c,u,l,d){function p(e){for(var o=t.couponSelectModel.coupons,n=0;n<o.length;++n){var r=o[n];r.id==e.id?(r.isSelected=!0,a.coupon=r,c.coupon=r):r.isSelected=!1}t.isSelectCoupon=g(),t.goBack()}function h(){for(var e=t.couponSelectModel.coupons,o=0;o<e.length;++o){var n=e[o];n.isSelected=!1}a.coupon="",c.coupon="",t.isSelectCoupon=g(),t.goBack()}function g(){for(var e=t.couponSelectModel.coupons,o=!1,n=0;n<e.length;++n){var r=e[n];r.isSelected&&(o=!0)}return!!o}t.toucheSelected=p,t.toucheUnUserCoupon=h,t.couponSelectModel=d,t.isSelectCoupon=!0,t.couponSelectModel.shopId=s.shopId,t.couponSelectModel.totalPrice=s.totalPrice,t.couponSelectModel.reload()}angular.module("app").controller("CouponSelectController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","ConfirmProductService","ConfirmCartService","API","ENUM","CouponSelectModel"]}(),function(){"use strict";function t(t,e){t.state("coupon-select",{needAuth:!1,url:"/coupon-select?shopId&totalPrice",title:"我的优惠券",templateUrl:"modules/coupon-select/coupon-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function t(t,e,o,n,r,i,s,a,c){function u(t){var e=new Date(1e3*parseInt(t)),o=e.getFullYear()+"-",n=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",r=e.getDate()+" ",i=e.getHours()+":",s=e.getMinutes()+":",a=e.getSeconds();return o+n+r+i+s+a}function l(t){for(var e in t){var o=t[e];s.coupon&&s.coupon.id==o.id?o.isSelected=!0:o.isSelected=!1,o.start_at=u(o.start_at),o.end_at=u(o.end_at)}}function d(){i.getToken()&&(this.isLoading||(this.coupons=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,g)))}function p(){i.getToken()&&(this.isLoading||this.isLastPage||(this.coupons&&this.coupons.length?this.fetch(this.coupons.length/g+1,g):this.fetch(1,g)))}function h(t,e){if(i.getToken()){this.isLoading=!0;var o={shop:this.shopId,total_price:this.totalPrice,page:t,per_page:e},n=this;a.coupon.available(o).then(function(t){var o=t.coupons;l(o),n.coupons=n.coupons?n.coupons.concat(o):o,n.isEmpty=!n.coupons||!n.coupons.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=o&&o.length<e?!n.isEmpty:!1})}}var g=10,f={};return f.isEmpty=!1,f.isLoaded=!1,f.isLoading=!1,f.isLastPage=!1,f.status=null,f.coupons=null,f.fetch=h,f.reload=d,f.loadMore=p,f}angular.module("app").factory("CouponSelectModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","ConfirmCartService","API","ENUM"]}();